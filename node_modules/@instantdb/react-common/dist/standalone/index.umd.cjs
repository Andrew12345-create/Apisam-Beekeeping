(function(le,k){typeof exports=="object"&&typeof module<"u"?k(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],k):(le=typeof globalThis<"u"?globalThis:le||self,k(le.instantReact={},le.React))})(this,function(le,k){"use strict";var bt={exports:{}},Ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fn;function ui(){if(fn)return Ie;fn=1;var t=k,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,u,d){var c,f={},l=null,p=null;d!==void 0&&(l=""+d),u.key!==void 0&&(l=""+u.key),u.ref!==void 0&&(p=u.ref);for(c in u)r.call(u,c)&&!s.hasOwnProperty(c)&&(f[c]=u[c]);if(a&&a.defaultProps)for(c in u=a.defaultProps,u)f[c]===void 0&&(f[c]=u[c]);return{$$typeof:e,type:a,key:l,ref:p,props:f,_owner:i.current}}return Ie.Fragment=n,Ie.jsx=o,Ie.jsxs=o,Ie}var Me={},ln;function ci(){if(ln)return Me;ln=1;var t={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return t.NODE_ENV!=="production"&&function(){var e=k,n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),u=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),l=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),b=Symbol.iterator,g="@@iterator";function m(h){if(h===null||typeof h!="object")return null;var _=b&&h[b]||h[g];return typeof _=="function"?_:null}var T=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function v(h){{for(var _=arguments.length,w=new Array(_>1?_-1:0),O=1;O<_;O++)w[O-1]=arguments[O];C("error",h,w)}}function C(h,_,w){{var O=T.ReactDebugCurrentFrame,P=O.getStackAddendum();P!==""&&(_+="%s",w=w.concat([P]));var I=w.map(function(j){return String(j)});I.unshift("Warning: "+_),Function.prototype.apply.call(console[h],console,I)}}var S=!1,R=!1,x=!1,W=!1,We=!1,dt;dt=Symbol.for("react.module.reference");function en(h){return!!(typeof h=="string"||typeof h=="function"||h===i||h===o||We||h===s||h===c||h===f||W||h===y||S||R||x||typeof h=="object"&&h!==null&&(h.$$typeof===p||h.$$typeof===l||h.$$typeof===a||h.$$typeof===u||h.$$typeof===d||h.$$typeof===dt||h.getModuleId!==void 0))}function tn(h,_,w){var O=h.displayName;if(O)return O;var P=_.displayName||_.name||"";return P!==""?w+"("+P+")":w}function ft(h){return h.displayName||"Context"}function se(h){if(h==null)return null;if(typeof h.tag=="number"&&v("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case i:return"Fragment";case r:return"Portal";case o:return"Profiler";case s:return"StrictMode";case c:return"Suspense";case f:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case u:var _=h;return ft(_)+".Consumer";case a:var w=h;return ft(w._context)+".Provider";case d:return tn(h,h.render,"ForwardRef");case l:var O=h.displayName||null;return O!==null?O:se(h.type)||"Memo";case p:{var P=h,I=P._payload,j=P._init;try{return se(j(I))}catch{return null}}}return null}var Te=Object.assign,qe=0,Fr,Nr,Kr,zr,Vr,Wr,qr;function Br(){}Br.__reactDisabledLog=!0;function Xa(){{if(qe===0){Fr=console.log,Nr=console.info,Kr=console.warn,zr=console.error,Vr=console.group,Wr=console.groupCollapsed,qr=console.groupEnd;var h={configurable:!0,enumerable:!0,value:Br,writable:!0};Object.defineProperties(console,{info:h,log:h,warn:h,error:h,group:h,groupCollapsed:h,groupEnd:h})}qe++}}function eu(){{if(qe--,qe===0){var h={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Te({},h,{value:Fr}),info:Te({},h,{value:Nr}),warn:Te({},h,{value:Kr}),error:Te({},h,{value:zr}),group:Te({},h,{value:Vr}),groupCollapsed:Te({},h,{value:Wr}),groupEnd:Te({},h,{value:qr})})}qe<0&&v("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var nn=T.ReactCurrentDispatcher,rn;function lt(h,_,w){{if(rn===void 0)try{throw Error()}catch(P){var O=P.stack.trim().match(/\n( *(at )?)/);rn=O&&O[1]||""}return`
`+rn+h}}var sn=!1,ht;{var tu=typeof WeakMap=="function"?WeakMap:Map;ht=new tu}function Gr(h,_){if(!h||sn)return"";{var w=ht.get(h);if(w!==void 0)return w}var O;sn=!0;var P=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var I;I=nn.current,nn.current=null,Xa();try{if(_){var j=function(){throw Error()};if(Object.defineProperty(j.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(j,[])}catch(H){O=H}Reflect.construct(h,[],j)}else{try{j.call()}catch(H){O=H}h.call(j.prototype)}}else{try{throw Error()}catch(H){O=H}h()}}catch(H){if(H&&O&&typeof H.stack=="string"){for(var A=H.stack.split(`
`),q=O.stack.split(`
`),$=A.length-1,L=q.length-1;$>=1&&L>=0&&A[$]!==q[L];)L--;for(;$>=1&&L>=0;$--,L--)if(A[$]!==q[L]){if($!==1||L!==1)do if($--,L--,L<0||A[$]!==q[L]){var X=`
`+A[$].replace(" at new "," at ");return h.displayName&&X.includes("<anonymous>")&&(X=X.replace("<anonymous>",h.displayName)),typeof h=="function"&&ht.set(h,X),X}while($>=1&&L>=0);break}}}finally{sn=!1,nn.current=I,eu(),Error.prepareStackTrace=P}var Pe=h?h.displayName||h.name:"",me=Pe?lt(Pe):"";return typeof h=="function"&&ht.set(h,me),me}function nu(h,_,w){return Gr(h,!1)}function ru(h){var _=h.prototype;return!!(_&&_.isReactComponent)}function pt(h,_,w){if(h==null)return"";if(typeof h=="function")return Gr(h,ru(h));if(typeof h=="string")return lt(h);switch(h){case c:return lt("Suspense");case f:return lt("SuspenseList")}if(typeof h=="object")switch(h.$$typeof){case d:return nu(h.render);case l:return pt(h.type,_,w);case p:{var O=h,P=O._payload,I=O._init;try{return pt(I(P),_,w)}catch{}}}return""}var Be=Object.prototype.hasOwnProperty,Qr={},Hr=T.ReactDebugCurrentFrame;function yt(h){if(h){var _=h._owner,w=pt(h.type,h._source,_?_.type:null);Hr.setExtraStackFrame(w)}else Hr.setExtraStackFrame(null)}function iu(h,_,w,O,P){{var I=Function.call.bind(Be);for(var j in h)if(I(h,j)){var A=void 0;try{if(typeof h[j]!="function"){var q=Error((O||"React class")+": "+w+" type `"+j+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof h[j]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw q.name="Invariant Violation",q}A=h[j](_,j,O,w,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch($){A=$}A&&!(A instanceof Error)&&(yt(P),v("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",O||"React class",w,j,typeof A),yt(null)),A instanceof Error&&!(A.message in Qr)&&(Qr[A.message]=!0,yt(P),v("Failed %s type: %s",w,A.message),yt(null))}}}var su=Array.isArray;function on(h){return su(h)}function ou(h){{var _=typeof Symbol=="function"&&Symbol.toStringTag,w=_&&h[Symbol.toStringTag]||h.constructor.name||"Object";return w}}function au(h){try{return Yr(h),!1}catch{return!0}}function Yr(h){return""+h}function Jr(h){if(au(h))return v("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ou(h)),Yr(h)}var Zr=T.ReactCurrentOwner,uu={key:!0,ref:!0,__self:!0,__source:!0},Xr,ei;function cu(h){if(Be.call(h,"ref")){var _=Object.getOwnPropertyDescriptor(h,"ref").get;if(_&&_.isReactWarning)return!1}return h.ref!==void 0}function du(h){if(Be.call(h,"key")){var _=Object.getOwnPropertyDescriptor(h,"key").get;if(_&&_.isReactWarning)return!1}return h.key!==void 0}function fu(h,_){typeof h.ref=="string"&&Zr.current}function lu(h,_){{var w=function(){Xr||(Xr=!0,v("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",_))};w.isReactWarning=!0,Object.defineProperty(h,"key",{get:w,configurable:!0})}}function hu(h,_){{var w=function(){ei||(ei=!0,v("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",_))};w.isReactWarning=!0,Object.defineProperty(h,"ref",{get:w,configurable:!0})}}var pu=function(h,_,w,O,P,I,j){var A={$$typeof:n,type:h,key:_,ref:w,props:j,_owner:I};return A._store={},Object.defineProperty(A._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(A,"_self",{configurable:!1,enumerable:!1,writable:!1,value:O}),Object.defineProperty(A,"_source",{configurable:!1,enumerable:!1,writable:!1,value:P}),Object.freeze&&(Object.freeze(A.props),Object.freeze(A)),A};function yu(h,_,w,O,P){{var I,j={},A=null,q=null;w!==void 0&&(Jr(w),A=""+w),du(_)&&(Jr(_.key),A=""+_.key),cu(_)&&(q=_.ref,fu(_,P));for(I in _)Be.call(_,I)&&!uu.hasOwnProperty(I)&&(j[I]=_[I]);if(h&&h.defaultProps){var $=h.defaultProps;for(I in $)j[I]===void 0&&(j[I]=$[I])}if(A||q){var L=typeof h=="function"?h.displayName||h.name||"Unknown":h;A&&lu(j,L),q&&hu(j,L)}return pu(h,A,q,P,O,Zr.current,j)}}var an=T.ReactCurrentOwner,ti=T.ReactDebugCurrentFrame;function Ce(h){if(h){var _=h._owner,w=pt(h.type,h._source,_?_.type:null);ti.setExtraStackFrame(w)}else ti.setExtraStackFrame(null)}var un;un=!1;function cn(h){return typeof h=="object"&&h!==null&&h.$$typeof===n}function ni(){{if(an.current){var h=se(an.current.type);if(h)return`

Check the render method of \``+h+"`."}return""}}function bu(h){return""}var ri={};function _u(h){{var _=ni();if(!_){var w=typeof h=="string"?h:h.displayName||h.name;w&&(_=`

Check the top-level render call using <`+w+">.")}return _}}function ii(h,_){{if(!h._store||h._store.validated||h.key!=null)return;h._store.validated=!0;var w=_u(_);if(ri[w])return;ri[w]=!0;var O="";h&&h._owner&&h._owner!==an.current&&(O=" It was passed a child from "+se(h._owner.type)+"."),Ce(h),v('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',w,O),Ce(null)}}function si(h,_){{if(typeof h!="object")return;if(on(h))for(var w=0;w<h.length;w++){var O=h[w];cn(O)&&ii(O,_)}else if(cn(h))h._store&&(h._store.validated=!0);else if(h){var P=m(h);if(typeof P=="function"&&P!==h.entries)for(var I=P.call(h),j;!(j=I.next()).done;)cn(j.value)&&ii(j.value,_)}}}function gu(h){{var _=h.type;if(_==null||typeof _=="string")return;var w;if(typeof _=="function")w=_.propTypes;else if(typeof _=="object"&&(_.$$typeof===d||_.$$typeof===l))w=_.propTypes;else return;if(w){var O=se(_);iu(w,h.props,"prop",O,h)}else if(_.PropTypes!==void 0&&!un){un=!0;var P=se(_);v("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",P||"Unknown")}typeof _.getDefaultProps=="function"&&!_.getDefaultProps.isReactClassApproved&&v("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Tu(h){{for(var _=Object.keys(h.props),w=0;w<_.length;w++){var O=_[w];if(O!=="children"&&O!=="key"){Ce(h),v("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",O),Ce(null);break}}h.ref!==null&&(Ce(h),v("Invalid attribute `ref` supplied to `React.Fragment`."),Ce(null))}}var oi={};function ai(h,_,w,O,P,I){{var j=en(h);if(!j){var A="";(h===void 0||typeof h=="object"&&h!==null&&Object.keys(h).length===0)&&(A+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var q=bu();q?A+=q:A+=ni();var $;h===null?$="null":on(h)?$="array":h!==void 0&&h.$$typeof===n?($="<"+(se(h.type)||"Unknown")+" />",A=" Did you accidentally export a JSX literal instead of a component?"):$=typeof h,v("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",$,A)}var L=yu(h,_,w,P,I);if(L==null)return L;if(j){var X=_.children;if(X!==void 0)if(O)if(on(X)){for(var Pe=0;Pe<X.length;Pe++)si(X[Pe],h);Object.freeze&&Object.freeze(X)}else v("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else si(X,h)}if(Be.call(_,"key")){var me=se(h),H=Object.keys(_).filter(function(Eu){return Eu!=="key"}),dn=H.length>0?"{key: someKey, "+H.join(": ..., ")+": ...}":"{key: someKey}";if(!oi[me+dn]){var Ou=H.length>0?"{"+H.join(": ..., ")+": ...}":"{}";v(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,dn,me,Ou,me),oi[me+dn]=!0}}return h===i?Tu(L):gu(L),L}}function mu(h,_,w){return ai(h,_,w,!0)}function wu(h,_,w){return ai(h,_,w,!1)}var vu=wu,Su=mu;Me.Fragment=i,Me.jsx=vu,Me.jsxs=Su}(),Me}var di={};di.NODE_ENV==="production"?bt.exports=ui():bt.exports=ci();var Ge=bt.exports;function N(t){if(typeof t=="number")return(Math.abs(t*2654435761)>>>0).toString(16);if(typeof t=="boolean")return t?"1":"0";if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string"){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24),e=e>>>0;return e.toString(16)}if(Array.isArray(t)){let e=2166136261;for(let n=0;n<t.length;n++){e^=(n+1)*2654435761;const r=N(t[n]);for(let i=0;i<r.length;i++)e^=r.charCodeAt(i),e*=16777619,e=e>>>0}return e.toString(16)}if(typeof t=="object"){let e=2166136261;const n=Object.keys(t).sort();for(let r=0;r<n.length;r++){const i=n[r],s=N(i);e^=parseInt(s,16),e*=16777619,e=e>>>0;const o=N(t[i]);e^=parseInt(o,16),e*=16777619,e=e>>>0}return e.toString(16)}return N(String(t))}const D={Remove:"remove",Replace:"replace",Add:"add"},hn=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),fi=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),Qe=Symbol.iterator,Y={mutable:"mutable",immutable:"immutable"},_t={};function Re(t,e){return t instanceof Map?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function pn(t,e){if(e in t){let n=Reflect.getPrototypeOf(t);for(;n;){const r=Reflect.getOwnPropertyDescriptor(n,e);if(r)return r;n=Reflect.getPrototypeOf(n)}}}function gt(t){return Object.getPrototypeOf(t)===Set.prototype}function Tt(t){return Object.getPrototypeOf(t)===Map.prototype}function J(t){var e;return(e=t.copy)!==null&&e!==void 0?e:t.original}function he(t){return!!E(t)}function E(t){return typeof t!="object"?null:t==null?void 0:t[hn]}function mt(t){var e;const n=E(t);return n?(e=n.copy)!==null&&e!==void 0?e:n.original:t}function ee(t,e){if(!t||typeof t!="object")return!1;let n;return Object.getPrototypeOf(t)===Object.prototype||Array.isArray(t)||t instanceof Map||t instanceof Set||!!(e!=null&&e.mark)&&((n=e.mark(t,Y))===Y.immutable||typeof n=="function")}function yn(t,e=[]){if(Object.hasOwnProperty.call(t,"key")){const n=t.parent.copy,r=E(oe(n,t.key));if(r!==null&&(r==null?void 0:r.original)!==t.original)return null;const i=t.parent.type===3,s=i?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key;if(!(i&&n.size>s||Re(n,s)))return null;e.push(s)}if(t.parent)return yn(t.parent,e);e.reverse();try{li(t.copy,e)}catch{return null}return e}function pe(t){return Array.isArray(t)?1:t instanceof Map?2:t instanceof Set?3:0}function oe(t,e){return pe(t)===2?t.get(e):t[e]}function xe(t,e,n){pe(t)===2?t.set(e,n):t[e]=n}function wt(t,e){const n=E(t);return(n?J(n):t)[e]}function ae(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function vt(t){if(t)for(;t.finalities.revoke.length>0;)t.finalities.revoke.pop()()}function ye(t,e){return e?t:[""].concat(t).map(n=>{const r=`${n}`;return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}function li(t,e){for(let n=0;n<e.length-1;n+=1){const r=e[n];if(t=oe(pe(t)===3?Array.from(t):t,r),typeof t!="object")throw new Error(`Cannot resolve patch at '${e.join("/")}'.`)}return t}function hi(t){const e=Object.create(Object.getPrototypeOf(t));return Reflect.ownKeys(t).forEach(n=>{let r=Reflect.getOwnPropertyDescriptor(t,n);if(r.enumerable&&r.configurable&&r.writable){e[n]=t[n];return}r.writable||(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(r={configurable:!0,writable:!0,enumerable:r.enumerable,value:t[n]}),Reflect.defineProperty(e,n,r)}),e}const pi=Object.prototype.propertyIsEnumerable;function bn(t,e){let n;if(Array.isArray(t))return Array.prototype.concat.call(t);if(t instanceof Set){if(!gt(t)){const r=Object.getPrototypeOf(t).constructor;return new r(t.values())}return Set.prototype.difference?Set.prototype.difference.call(t,new Set):new Set(t.values())}else if(t instanceof Map){if(!Tt(t)){const r=Object.getPrototypeOf(t).constructor;return new r(t)}return new Map(t)}else if(e!=null&&e.mark&&(n=e.mark(t,Y),n!==void 0)&&n!==Y.mutable){if(n===Y.immutable)return hi(t);if(typeof n=="function"){if(e.enablePatches||e.enableAutoFreeze)throw new Error("You can't use mark and patches or auto freeze together.");return n()}throw new Error(`Unsupported mark result: ${n}`)}else if(typeof t=="object"&&Object.getPrototypeOf(t)===Object.prototype){const r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),Object.getOwnPropertySymbols(t).forEach(i=>{pi.call(t,i)&&(r[i]=t[i])}),r}else throw new Error("Please check mark() to ensure that it is a stable marker draftable function.")}function V(t){t.copy||(t.copy=bn(t.original,t.options))}function De(t){if(!ee(t))return mt(t);if(Array.isArray(t))return t.map(De);if(t instanceof Map){const n=Array.from(t.entries()).map(([r,i])=>[r,De(i)]);if(!Tt(t)){const r=Object.getPrototypeOf(t).constructor;return new r(n)}return new Map(n)}if(t instanceof Set){const n=Array.from(t).map(De);if(!gt(t)){const r=Object.getPrototypeOf(t).constructor;return new r(n)}return new Set(n)}const e=Object.create(Object.getPrototypeOf(t));for(const n in t)e[n]=De(t[n]);return e}function He(t){return he(t)?De(t):t}function re(t){var e;t.assignedMap=(e=t.assignedMap)!==null&&e!==void 0?e:new Map,t.operated||(t.operated=!0,t.parent&&re(t.parent))}function _n(){throw new Error("Cannot modify frozen object")}function we(t,e,n,r,i){{n=n??new WeakMap,r=r??[],i=i??[];const o=n.has(t)?n.get(t):t;if(r.length>0){const a=r.indexOf(o);if(o&&typeof o=="object"&&a!==-1)throw r[0]===o?new Error("Forbids circular reference"):new Error(`Forbids circular reference: ~/${i.slice(0,a).map((u,d)=>{if(typeof u=="symbol")return`[${u.toString()}]`;const c=r[d];return typeof u=="object"&&(c instanceof Map||c instanceof Set)?Array.from(c.keys()).indexOf(u):u}).join("/")}`);r.push(o),i.push(e)}else r.push(o)}if(Object.isFrozen(t)||he(t)){r.pop(),i.pop();return}switch(pe(t)){case 2:for(const[a,u]of t)we(a,a,n,r,i),we(u,a,n,r,i);t.set=t.clear=t.delete=_n;break;case 3:for(const a of t)we(a,a,n,r,i);t.add=t.clear=t.delete=_n;break;case 1:Object.freeze(t);let o=0;for(const a of t)we(a,o,n,r,i),o+=1;break;default:Object.freeze(t),Object.keys(t).forEach(a=>{const u=t[a];we(u,a,n,r,i)})}r.pop(),i.pop()}function St(t,e){const n=pe(t);if(n===0)Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)});else if(n===1){let r=0;for(const i of t)e(r,i,t),r+=1}else t.forEach((r,i)=>e(i,r,t))}function gn(t,e,n){if(he(t)||!ee(t,n)||e.has(t)||Object.isFrozen(t))return;const r=t instanceof Set,i=r?new Map:void 0;if(e.add(t),St(t,(s,o)=>{var a;if(he(o)){const u=E(o);V(u);const d=!((a=u.assignedMap)===null||a===void 0)&&a.size||u.operated?u.copy:u.original;xe(r?i:t,s,d)}else gn(o,e,n)}),i){const s=t,o=Array.from(s);s.clear(),o.forEach(a=>{s.add(i.has(a)?i.get(a):a)})}}function yi(t,e){const n=t.type===3?t.setMap:t.copy;t.finalities.revoke.length>1&&t.assignedMap.get(e)&&n&&gn(oe(n,e),t.finalities.handledSet,t.options)}function Ot(t){t.type===3&&t.copy&&(t.copy.clear(),t.setMap.forEach(e=>{t.copy.add(mt(e))}))}function Et(t,e,n,r){if(t.operated&&t.assignedMap&&t.assignedMap.size>0&&!t.finalized){if(n&&r){const s=yn(t);s&&e(t,s,n,r)}t.finalized=!0}}function At(t,e,n,r){const i=E(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push((s,o)=>{var a;const u=t.type===3?t.setMap:t.copy;if(ae(oe(u,e),n)){let d=i.original;i.copy&&(d=i.copy),Ot(t),Et(t,r,s,o),t.options.enableAutoFreeze&&(t.options.updatedValues=(a=t.options.updatedValues)!==null&&a!==void 0?a:new WeakMap,t.options.updatedValues.set(d,i.original)),xe(u,e,d)}}),t.options.enableAutoFreeze&&i.finalities!==t.finalities&&(t.options.enableAutoFreeze=!1)),ee(n,t.options)&&t.finalities.draft.push(()=>{const s=t.type===3?t.setMap:t.copy;ae(oe(s,e),n)&&yi(t,e)})}function bi(t,e,n,r,i){let{original:s,assignedMap:o,options:a}=t,u=t.copy;u.length<s.length&&([s,u]=[u,s],[n,r]=[r,n]);for(let d=0;d<s.length;d+=1)if(o.get(d.toString())&&u[d]!==s[d]){const c=e.concat([d]),f=ye(c,i);n.push({op:D.Replace,path:f,value:He(u[d])}),r.push({op:D.Replace,path:f,value:He(s[d])})}for(let d=s.length;d<u.length;d+=1){const c=e.concat([d]),f=ye(c,i);n.push({op:D.Add,path:f,value:He(u[d])})}if(s.length<u.length){const{arrayLengthAssignment:d=!0}=a.enablePatches;if(d){const c=e.concat(["length"]),f=ye(c,i);r.push({op:D.Replace,path:f,value:s.length})}else for(let c=u.length;s.length<c;c-=1){const f=e.concat([c-1]),l=ye(f,i);r.push({op:D.Remove,path:l})}}}function _i({original:t,copy:e,assignedMap:n},r,i,s,o){n.forEach((a,u)=>{const d=oe(t,u),c=He(oe(e,u)),f=a?Re(t,u)?D.Replace:D.Add:D.Remove;if(ae(d,c)&&f===D.Replace)return;const l=r.concat(u),p=ye(l,o);i.push(f===D.Remove?{op:f,path:p}:{op:f,path:p,value:c}),s.push(f===D.Add?{op:D.Remove,path:p}:f===D.Remove?{op:D.Add,path:p,value:d}:{op:D.Replace,path:p,value:d})})}function gi({original:t,copy:e},n,r,i,s){let o=0;t.forEach(a=>{if(!e.has(a)){const u=n.concat([o]),d=ye(u,s);r.push({op:D.Remove,path:d,value:a}),i.unshift({op:D.Add,path:d,value:a})}o+=1}),o=0,e.forEach(a=>{if(!t.has(a)){const u=n.concat([o]),d=ye(u,s);r.push({op:D.Add,path:d,value:a}),i.unshift({op:D.Remove,path:d,value:a})}o+=1})}function $e(t,e,n,r){const{pathAsArray:i=!0}=t.options.enablePatches;switch(t.type){case 0:case 2:return _i(t,e,n,r,i);case 1:return bi(t,e,n,r,i);case 3:return gi(t,e,n,r,i)}}const Ye=(t,e,n=!1)=>{if(typeof t=="object"&&t!==null&&(!ee(t,e)||n))throw new Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},kt={get size(){return J(E(this)).size},has(t){return J(E(this)).has(t)},set(t,e){const n=E(this),r=J(n);return(!r.has(t)||!ae(r.get(t),e))&&(V(n),re(n),n.assignedMap.set(t,!0),n.copy.set(t,e),At(n,t,e,$e)),this},delete(t){if(!this.has(t))return!1;const e=E(this);return V(e),re(e),e.original.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.copy.delete(t),!0},clear(){const t=E(this);if(this.size){V(t),re(t),t.assignedMap=new Map;for(const[e]of t.original)t.assignedMap.set(e,!1);t.copy.clear()}},forEach(t,e){const n=E(this);J(n).forEach((r,i)=>{t.call(e,this.get(i),i,this)})},get(t){var e,n;const r=E(this),i=J(r).get(t),s=((n=(e=r.options).mark)===null||n===void 0?void 0:n.call(e,i,Y))===Y.mutable;if(r.options.strict&&Ye(i,r.options,s),s||r.finalized||!ee(i,r.options)||i!==r.original.get(t))return i;const o=_t.createDraft({original:i,parentDraft:r,key:t,finalities:r.finalities,options:r.options});return V(r),r.copy.set(t,o),o},keys(){return J(E(this)).keys()},values(){const t=this.keys();return{[Qe]:()=>this.values(),next:()=>{const e=t.next();return e.done?e:{done:!1,value:this.get(e.value)}}}},entries(){const t=this.keys();return{[Qe]:()=>this.entries(),next:()=>{const e=t.next();if(e.done)return e;const n=this.get(e.value);return{done:!1,value:[e.value,n]}}}},[Qe](){return this.entries()}},Ti=Reflect.ownKeys(kt),Tn=(t,e,{isValuesIterator:n})=>()=>{var r,i;const s=e.next();if(s.done)return s;const o=s.value;let a=t.setMap.get(o);const u=E(a),d=((i=(r=t.options).mark)===null||i===void 0?void 0:i.call(r,a,Y))===Y.mutable;if(t.options.strict&&Ye(o,t.options,d),!d&&!u&&ee(o,t.options)&&!t.finalized&&t.original.has(o)){const c=_t.createDraft({original:o,parentDraft:t,key:o,finalities:t.finalities,options:t.options});t.setMap.set(o,c),a=c}else u&&(a=u.proxy);return{done:!1,value:n?a:[a,a]}},Je={get size(){return E(this).setMap.size},has(t){const e=E(this);if(e.setMap.has(t))return!0;V(e);const n=E(t);return!!(n&&e.setMap.has(n.original))},add(t){const e=E(this);return this.has(t)||(V(e),re(e),e.assignedMap.set(t,!0),e.setMap.set(t,t),At(e,t,t,$e)),this},delete(t){if(!this.has(t))return!1;const e=E(this);V(e),re(e);const n=E(t);return n&&e.setMap.has(n.original)?(e.assignedMap.set(n.original,!1),e.setMap.delete(n.original)):(!n&&e.setMap.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.setMap.delete(t))},clear(){if(!this.size)return;const t=E(this);V(t),re(t);for(const e of t.original)t.assignedMap.set(e,!1);t.setMap.clear()},values(){const t=E(this);V(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:Tn(t,e,{isValuesIterator:!0})}},entries(){const t=E(this);V(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:Tn(t,e,{isValuesIterator:!1})}},keys(){return this.values()},[Qe](){return this.values()},forEach(t,e){const n=this.values();let r=n.next();for(;!r.done;)t.call(e,r.value,r.value,this),r=n.next()}};Set.prototype.difference&&Object.assign(Je,{intersection(t){return Set.prototype.intersection.call(new Set(this.values()),t)},union(t){return Set.prototype.union.call(new Set(this.values()),t)},difference(t){return Set.prototype.difference.call(new Set(this.values()),t)},symmetricDifference(t){return Set.prototype.symmetricDifference.call(new Set(this.values()),t)},isSubsetOf(t){return Set.prototype.isSubsetOf.call(new Set(this.values()),t)},isSupersetOf(t){return Set.prototype.isSupersetOf.call(new Set(this.values()),t)},isDisjointFrom(t){return Set.prototype.isDisjointFrom.call(new Set(this.values()),t)}});const mi=Reflect.ownKeys(Je),mn=new WeakSet,wn={get(t,e,n){var r,i;const s=(r=t.copy)===null||r===void 0?void 0:r[e];if(s&&mn.has(s))return s;if(e===hn)return t;let o;if(t.options.mark){const d=e==="size"&&(t.original instanceof Map||t.original instanceof Set)?Reflect.get(t.original,e):Reflect.get(t.original,e,n);if(o=t.options.mark(d,Y),o===Y.mutable)return t.options.strict&&Ye(d,t.options,!0),d}const a=J(t);if(a instanceof Map&&Ti.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(kt,"size").get.call(t.proxy);const d=kt[e];if(d)return d.bind(t.proxy)}if(a instanceof Set&&mi.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(Je,"size").get.call(t.proxy);const d=Je[e];if(d)return d.bind(t.proxy)}if(!Re(a,e)){const d=pn(a,e);return d?"value"in d?d.value:(i=d.get)===null||i===void 0?void 0:i.call(t.proxy):void 0}const u=a[e];if(t.options.strict&&Ye(u,t.options),t.finalized||!ee(u,t.options))return u;if(u===wt(t.original,e)){if(V(t),t.copy[e]=jt({original:t.original[e],parentDraft:t,key:t.type===1?Number(e):e,finalities:t.finalities,options:t.options}),typeof o=="function"){const d=E(t.copy[e]);return V(d),re(d),d.copy}return t.copy[e]}return u},set(t,e,n){var r;if(t.type===3||t.type===2)throw new Error("Map/Set draft does not support any property assignment.");let i;if(t.type===1&&e!=="length"&&!(Number.isInteger(i=Number(e))&&i>=0&&(e===0||i===0||String(i)===String(e))))throw new Error("Only supports setting array indices and the 'length' property.");const s=pn(J(t),e);if(s!=null&&s.set)return s.set.call(t.proxy,n),!0;const o=wt(J(t),e),a=E(o);return a&&ae(a.original,n)?(t.copy[e]=n,t.assignedMap=(r=t.assignedMap)!==null&&r!==void 0?r:new Map,t.assignedMap.set(e,!1),!0):(ae(n,o)&&(n!==void 0||Re(t.original,e))||(V(t),re(t),Re(t.original,e)&&ae(n,t.original[e])?t.assignedMap.delete(e):t.assignedMap.set(e,!0),t.copy[e]=n,At(t,e,n,$e)),!0)},has(t,e){return e in J(t)},ownKeys(t){return Reflect.ownKeys(J(t))},getOwnPropertyDescriptor(t,e){const n=J(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},getPrototypeOf(t){return Reflect.getPrototypeOf(t.original)},setPrototypeOf(){throw new Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw new Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(t,e){var n;return t.type===1?wn.set.call(this,t,e,void 0,t.proxy):(wt(t.original,e)!==void 0||e in t.original?(V(t),re(t),t.assignedMap.set(e,!1)):(t.assignedMap=(n=t.assignedMap)!==null&&n!==void 0?n:new Map,t.assignedMap.delete(e)),t.copy&&delete t.copy[e],!0)}};function jt(t){const{original:e,parentDraft:n,key:r,finalities:i,options:s}=t,o=pe(e),a={type:o,finalized:!1,parent:n,original:e,copy:null,proxy:null,finalities:i,options:s,setMap:o===3?new Map(e.entries()):void 0};(r||"key"in t)&&(a.key=r);const{proxy:u,revoke:d}=Proxy.revocable(o===1?Object.assign([],a):a,wn);if(i.revoke.push(d),mn.add(u),a.proxy=u,n){const c=n;c.finalities.draft.push((f,l)=>{var p,y;const b=E(u);let g=c.type===3?c.setMap:c.copy;const m=oe(g,r),T=E(m);if(T){let v=T.original;T.operated&&(v=mt(m)),Ot(T),Et(T,$e,f,l),c.options.enableAutoFreeze&&(c.options.updatedValues=(p=c.options.updatedValues)!==null&&p!==void 0?p:new WeakMap,c.options.updatedValues.set(v,T.original)),xe(g,r,v)}(y=b.callbacks)===null||y===void 0||y.forEach(v=>{v(f,l)})})}else{const c=E(u);c.finalities.draft.push((f,l)=>{Ot(c),Et(c,$e,f,l)})}return u}_t.createDraft=jt;function wi(t,e,n,r,i){var s;const o=E(t),a=(s=o==null?void 0:o.original)!==null&&s!==void 0?s:t,u=!!e.length;if(o!=null&&o.operated)for(;o.finalities.draft.length>0;)o.finalities.draft.pop()(n,r);const d=u?e[0]:o?o.operated?o.copy:o.original:t;return o&&vt(o),i&&we(d,d,o==null?void 0:o.options.updatedValues),[d,n&&u?[{op:D.Replace,path:[],value:e[0]}]:n,r&&u?[{op:D.Replace,path:[],value:a}]:r]}function vi(t,e){var n;const r={draft:[],revoke:[],handledSet:new WeakSet};let i,s;e.enablePatches&&(i=[],s=[]);const a=((n=e.mark)===null||n===void 0?void 0:n.call(e,t,Y))===Y.mutable||!ee(t,e)?t:jt({original:t,parentDraft:null,finalities:r,options:e});return[a,(u=[])=>{const[d,c,f]=wi(a,u,i,s,e.enableAutoFreeze);return e.enablePatches?[d,c,f]:d}]}function Ct(t){const{rootDraft:e,value:n,useRawReturn:r=!1,isRoot:i=!0}=t;St(n,(s,o,a)=>{const u=E(o);if(u&&e&&u.finalities===e.finalities){t.isContainDraft=!0;const d=u.original;if(a instanceof Set){const c=Array.from(a);a.clear(),c.forEach(f=>a.add(s===f?d:f))}else xe(a,s,d)}else typeof o=="object"&&o!==null&&(t.value=o,t.isRoot=!1,Ct(t))}),i&&(t.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function vn(t){var e;const n=E(t);if(!ee(t,n==null?void 0:n.options))return t;const r=pe(t);if(n&&!n.operated)return n.original;let i;function s(){i=r===2?Tt(t)?new Map(t):new(Object.getPrototypeOf(t)).constructor(t):r===3?Array.from(n.setMap.values()):bn(t,n==null?void 0:n.options)}if(n){n.finalized=!0;try{s()}finally{n.finalized=!1}}else i=t;if(St(i,(o,a)=>{if(n&&ae(oe(n.original,o),a))return;const u=vn(a);u!==a&&(i===t&&s(),xe(i,o,u))}),r===3){const o=(e=n==null?void 0:n.original)!==null&&e!==void 0?e:i;return gt(o)?new Set(i):new(Object.getPrototypeOf(o)).constructor(i)}return i}function Sn(t){if(!he(t))throw new Error(`current() is only used for Draft, parameter: ${t}`);return vn(t)}const Ze=(t=>function e(n,r,i){var s,o,a;if(typeof n=="function"&&typeof r!="function")return function(S,...R){return e(S,x=>n.call(this,x,...R),r)};const u=n,d=r;let c=i;if(typeof r!="function"&&(c=r),c!==void 0&&Object.prototype.toString.call(c)!=="[object Object]")throw new Error(`Invalid options: ${c}, 'options' should be an object.`);c=Object.assign(Object.assign({},t),c);const f=he(u)?Sn(u):u,l=Array.isArray(c.mark)?(S,R)=>{for(const x of c.mark){if(typeof x!="function")throw new Error(`Invalid mark: ${x}, 'mark' should be a function.`);const W=x(S,R);if(W)return W}}:c.mark,p=(s=c.enablePatches)!==null&&s!==void 0?s:!1,y=(o=c.strict)!==null&&o!==void 0?o:!1,g={enableAutoFreeze:(a=c.enableAutoFreeze)!==null&&a!==void 0?a:!1,mark:l,strict:y,enablePatches:p};if(!ee(f,g)&&typeof f=="object"&&f!==null)throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");const[m,T]=vi(f,g);if(typeof r!="function"){if(!ee(f,g))throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[m,T]}let v;try{v=d(m)}catch(S){throw vt(E(m)),S}const C=S=>{const R=E(m);if(!he(S)){if(S!==void 0&&!ae(S,m)&&(R!=null&&R.operated))throw new Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");const W=S==null?void 0:S[fi];if(W){const We=W[0];return g.strict&&typeof S=="object"&&S!==null&&Ct({rootDraft:R,value:S,useRawReturn:!0}),T([We])}if(S!==void 0)return typeof S=="object"&&S!==null&&Ct({rootDraft:R,value:S}),T([S])}if(S===m||S===void 0)return T([]);const x=E(S);if(g===x.options){if(x.operated)throw new Error("Cannot return a modified child draft.");return T([Sn(S)])}return T([S])};return v instanceof Promise?v.then(C,S=>{throw vt(E(m)),S}):C(v)})();Object.prototype.constructor.toString();function On(t,e){const n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&Object.keys(t).every(i=>e.hasOwnProperty(i))}function En(t,e){return Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every(n=>e.hasOwnProperty(n)&&t[n]===e[n])}function Xe(t,e){return typeof t!="object"||typeof e!="object"||t===null||e===null?t===e:On(t,e)?Object.keys(t).every(n=>Xe(t[n],e[n])):!1}function Pt(t){if(!Ue(t))return t;const e={};for(const[n,r]of Object.entries(t))r!==void 0&&(e[n]=r);return e}function An(t,e){if(!Ue(t)||!Ue(e))return e;const n=Object.assign({},t);for(const r of Object.keys(e)){if(e[r]===void 0)continue;if(e[r]===null){delete n[r];continue}const i=Ue(t[r])&&Ue(e[r]);n[r]=i?An(t[r],e[r]):e[r]}return n}function Ue(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Si(t,e,n){if(!t||e.length===0)return;let r=t||{};for(let s=0;s<e.length-1;s++){const o=e[s];(!(o in r)||typeof r[o]!="object")&&(r[o]=typeof e[s+1]=="number"?[]:{}),r=r[o]}const i=e[e.length-1];Array.isArray(r)&&typeof i=="number"?r.splice(i,0,n):r[i]=n}function kn(t,e,n){if(!t||e.length===0)return;let r=t||{};for(let i=0;i<e.length-1;i++){const s=e[i];(!(s in r)||typeof r[s]!="object")&&(r[s]=typeof e[i+1]=="number"?[]:{}),r=r[s]}r[e[e.length-1]]=n}function jn(t,e){if(!t||e.length===0)return;const[n,...r]=e;if(n in t){if(r.length===0){Array.isArray(t)?t.splice(n,1):delete t[n];return}jn(t[n],r),Oi(t[n])&&delete t[n]}}function Oi(t){return t&&Object.keys(t).length===0}const Cn=/ZULU|YEKT|YEKST|YAPT|YAKT|YAKST|XJT|WGT|WGST|WFT|WETDST|WET|WDT|WAT|WAST|WAKT|WADT|VUT|VOLT|VLAT|VLAST|VET|UZT|UZST|UYT|UYST|UTC|UT|ULAT|ULAST|UCT|TVT|TRUT|TOT|TMT|TKT|TJT|TFT|TAHT|SGT|SCT|SAST|SADT|RET|PYT|PYST|PWT|PST|PONT|PMST|PMDT|PKT|PKST|PHT|PGT|PETT|PETST|PET|PDT|OMST|OMSST|NZT|NZST|NZDT|NUT|NST|NPT|NOVT|NOVST|NFT|NDT|MYT|MVT|MUT|MUST|MST|MSK|MSD|MPT|MMT|MHT|MEZ|METDST|MET|MESZ|MEST|MDT|MAWT|MART|MAGT|MAGST|LKT|LINT|LIGT|LHST|LHDT|KST|KRAT|KRAST|KOST|KGT|KGST|KDT|JST|JAYT|IST|IRT|IRKT|IRKST|IOT|IDT|ICT|HST|HKT|GYT|GMT|GILT|GFT|GET|GEST|GAMT|GALT|FNT|FNST|FKT|FKST|FJT|FJST|FET|EST|EGT|EGST|EETDST|EET|EEST|EDT|EAT|EAST|EASST|DDUT|DAVT|CXT|CST|COT|CLT|CLST|CKT|CHUT|CHAST|CHADT|CETDST|CET|CEST|CDT|CCT|CAST|CADT|BTT|BST|BRT|BRST|BRA|BOT|BORT|BNT|BDT|BDST|AZT|AZST|AZOT|AZOST|AWST|AWSST|AST|ART|ARST|ANAT|ANAST|AMT|AMST|ALMT|ALMST|AKST|AKDT|AFT|AEST|AESST|AEDT|ADT|ACWST|ACT|ACST|ACSST|ACDT$/,Ei={ZULU:0,YEKT:18e3,YEKST:21600,YAPT:36e3,YAKT:32400,YAKST:32400,XJT:21600,WGT:-10800,WGST:-7200,WFT:43200,WETDST:3600,WET:0,WDT:32400,WAT:3600,WAST:25200,WAKT:43200,WADT:28800,VUT:39600,VOLT:10800,VLAT:36e3,VLAST:36e3,VET:-14400,UZT:18e3,UZST:21600,UYT:-10800,UYST:-7200,UTC:0,UT:0,ULAT:28800,ULAST:32400,UCT:0,TVT:43200,TRUT:36e3,TOT:46800,TMT:18e3,TKT:46800,TJT:18e3,TFT:18e3,TAHT:-36e3,SGT:28800,SCT:14400,SAST:7200,SADT:37800,RET:14400,PYT:-14400,PYST:-10800,PWT:32400,PST:-28800,PONT:39600,PMST:-10800,PMDT:-7200,PKT:18e3,PKST:21600,PHT:28800,PGT:36e3,PETT:43200,PETST:43200,PET:-18e3,PDT:-25200,OMST:21600,OMSST:21600,NZT:43200,NZST:43200,NZDT:46800,NUT:-39600,NST:-12600,NPT:20700,NOVT:25200,NOVST:25200,NFT:-12600,NDT:-9e3,MYT:28800,MVT:18e3,MUT:14400,MUST:18e3,MST:-25200,MSK:10800,MSD:14400,MPT:36e3,MMT:23400,MHT:43200,MEZ:3600,METDST:7200,MET:3600,MESZ:7200,MEST:7200,MDT:-21600,MAWT:18e3,MART:-34200,MAGT:39600,MAGST:39600,LKT:19800,LINT:50400,LIGT:36e3,LHST:37800,LHDT:37800,KST:32400,KRAT:25200,KRAST:25200,KOST:39600,KGT:21600,KGST:21600,KDT:36e3,JST:32400,JAYT:32400,IST:7200,IRT:12600,IRKT:28800,IRKST:28800,IOT:21600,IDT:10800,ICT:25200,HST:-36e3,HKT:28800,GYT:-14400,GMT:0,GILT:43200,GFT:-10800,GET:14400,GEST:14400,GAMT:-32400,GALT:-21600,FNT:-7200,FNST:-3600,FKT:-10800,FKST:-10800,FJT:43200,FJST:46800,FET:10800,EST:-18e3,EGT:-3600,EGST:0,EETDST:10800,EET:7200,EEST:10800,EDT:-14400,EAT:10800,EAST:-21600,EASST:-21600,DDUT:36e3,DAVT:25200,CXT:25200,CST:-21600,COT:-18e3,CLT:-14400,CLST:-10800,CKT:-36e3,CHUT:36e3,CHAST:45900,CHADT:49500,CETDST:7200,CET:3600,CEST:7200,CDT:-18e3,CCT:28800,CAST:34200,CADT:37800,BTT:21600,BST:3600,BRT:-10800,BRST:-7200,BRA:-10800,BOT:-14400,BORT:28800,BNT:28800,BDT:21600,BDST:7200,AZT:14400,AZST:14400,AZOT:-3600,AZOST:0,AWST:28800,AWSST:32400,AST:-14400,ART:-10800,ARST:-10800,ANAT:43200,ANAST:43200,AMT:-14400,AMST:14400,ALMT:21600,ALMST:25200,AKST:-32400,AKDT:-28800,AFT:16200,AEST:36e3,AESST:39600,AEDT:39600,ADT:-10800,ACWST:31500,ACT:-18e3,ACST:34200,ACSST:37800,ACDT:37800};function Ai(t){return new Date(t)}function ki(t){return new Date(t+"Z")}const ji=/^(\d+)[\./-](\d+)[\./-](\d+)$/;function Ci(t){const e=t.match(ji);if(!e)return null;const[n,r,i,s]=e;return r<=0||i<=0||s<=0?null:r>999?new Date(Date.UTC(r,i-1,s,0,0,0,0)):new Date(Date.UTC(s,r-1,i,0,0,0,0))}function Pi(t){const[e,n]=t.split(" ");return new Date(e+"T"+n+"Z")}function Ii(t){const[e,n]=t.split(" ");return new Date(e+"T"+n+"Z")}function Mi(t){return new Date(t)}function Ri(t){const e=/^(\w{3}) (\w{3}) (\d{2}) (\d{4})$/;if(!t.match(e))throw new Error(`Unable to parse \`${t}\` as a date.`);const r=new Date(t+" UTC");return new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),0,0,0,0))}function xi(t){const e=/^(.+T.+)([+-])(\d{2})$/,n=t.match(e);if(n){const[,r,i,s]=n,o=`${r}${i}${s}:00`;return new Date(o)}return null}function Di(t){const e=/^(\d+)-(\d{1,2})-(\d{1,2})([ T])(.+)$/,n=t.match(e);if(n){const[,r,i,s,o,a]=n,u=i.padStart(2,"0"),d=s.padStart(2,"0"),c=`${r}-${u}-${d}T${a}`;return new Date(c)}return null}function $i(t){const[e,n]=t.split(", "),[r,i,s]=e.split("/").map(Number),o=n.match(/(\d{1,2}):(\d{2}):(\d{2}) (AM|PM)/);if(!o)throw new Error(`Unable to parse time from: ${t}`);let[,a,u,d,c]=o;return a=Number(a),u=Number(u),d=Number(d),c==="PM"&&a!==12?a+=12:c==="AM"&&a===12&&(a=0),new Date(Date.UTC(s,r-1,i,a,u,d))}function Ui(t){switch(t){case"epoch":return new Date(0);case"infinity":case"-infinity":case"today":case"tomorrow":case"yesterday":return null}}function Li(t){const e=t.match(Cn);if(!e)return null;const[n]=e,r=Ei[n],i=new Date(t.replace(Cn,"Z"));return new Date(i.getTime()-r*1e3)}const Fi=[Ci,Ii,Ri,$i,Mi,ki,xi,Pi,Ai,Ui,Li,Di];function Ni(t,e){try{const n=t(e);return n instanceof Date&&!isNaN(n.getTime())?n:null}catch{return null}}function It(t){for(const e of Fi){const n=Ni(e,t);if(n)return n}return null}function Ki(t){try{const e=JSON.parse(t);return typeof e=="string"?It(e):null}catch{return null}}function et(t){if(t!==void 0){if(t===null)return null;if(t instanceof Date)return t;if(typeof t=="string"){const e=It(t)||Ki(t)||It(t.trim());if(!e)throw new Error(`Unable to parse \`${t}\` as a date.`);return e}else if(typeof t=="number")return new Date(t);throw new Error(`Invalid date value \`${t}\`. Expected a date, number, or string, got type ${typeof t}.`)}}function zi(t){return t.cardinality==="one"}function Mt(t){return t["value-type"]==="ref"}function Rt(t){return t["value-type"]==="blob"}function ve(t,e){return t[e]}function Se(t,e){return e.reduce((n,r)=>n&&n.get(r),t)}function te(t,e){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.delete(e[0]);return}const[n,...r]=e;t.has(n)&&te(t.get(n),r)}function B(t,e,n){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.set(e[0],n);return}const[r,...i]=e;let s=t.get(r);s||(s=new Map,t.set(r,s)),B(s,i,n)}function Pn(t,e,n){const r=new Map,i=new Map,s=new Map;for(const o of e){let[a,u,d,c]=o;const f=ve(t,u);if(!f){console.warn("no such attr",a,t);continue}f["checked-data-type"]==="date"&&n&&(d=et(d),o[2]=d),Mt(f)&&B(s,[d,u,a],o),B(r,[a,u,d],o),B(i,[u,a,d],o)}return{eav:r,aev:i,vae:s}}function In(t){const e=new Map,n=new Map,r=new Map,i=new Map;for(const s of Object.values(t)){const o=s["forward-identity"],[a,u,d]=o,c=s["reverse-identity"];if(B(r,[u,d],s),Rt(s)&&B(e,[u,d],s),s["primary?"]&&B(n,[u],s),c){const[f,l,p]=c;B(i,[l,p],s)}}return{blobAttrs:e,primaryKeys:n,forwardIdents:r,revIdents:i}}function Mn(t){return{__type:t.__type,attrs:t.attrs,triples:G(t.eav,3),cardinalityInference:t.cardinalityInference,linkIndex:t.linkIndex,useDateObjects:t.useDateObjects}}function Rn(t){return tt(t.attrs,t.triples,t.cardinalityInference,t.linkIndex,t.useDateObjects)}function Vi(t,e){return Se(t.eav,[e])!==void 0}function xt(t){t.attrIndexes=In(t.attrs)}function tt(t,e,n,r,i){const s=Pn(t,e,i);return s.useDateObjects=i,s.attrs=t,s.attrIndexes=In(t),s.cardinalityInference=n,s.linkIndex=r,s.__type="store",s}function Le(t,e){var n,r;let i;if(Array.isArray(e[0])){const[o,a]=e[0],u=t.aev.get(o);if(!u)return null;i=(n=G(u,2).find(c=>c[2]===a))===null||n===void 0?void 0:n[0]}else i=e[0];if(!i)return null;const s=e[2];if(Array.isArray(s)&&s.length===2&&t.aev.get(s[0])){const[o,a]=s,u=t.aev.get(o);if(!u)return null;const c=(r=G(u,2).find(b=>b[2]===a))===null||r===void 0?void 0:r[0];if(!c)return null;const[f,l,p,...y]=e;return[i,l,c,...y]}else{const[o,...a]=e;return[i,...a]}}function xn(t,e){const n=Le(t,e);if(!n)return;const[r,i,s]=n,o=ve(t.attrs,i);o&&(te(t.eav,[r,i,s]),te(t.aev,[i,r,s]),Mt(o)&&te(t.vae,[s,i,r]))}let Wi=0;function Dn(t,e,n){const[r,i,s]=n;let o;const a=Se(t.eav,[r,i,s]);return a&&(o=a[3]),o||Date.now()*10+Wi++}function $n(t,e){var n;const r=Le(t,e);if(!r)return;let[i,s,o]=r;const a=ve(t.attrs,s);if(!a)return;a["checked-data-type"]==="date"&&t.useDateObjects&&(o=et(o));const u=Se(t.eav,[i,s,o]),d=(n=u==null?void 0:u[3])!==null&&n!==void 0?n:Dn(t,a,r),c=[i,s,o,d];zi(a)?(B(t.eav,[i,s],new Map([[o,c]])),B(t.aev,[s,i],new Map([[o,c]]))):(B(t.eav,[i,s,o],c),B(t.aev,[s,i,o],c)),Mt(a)&&B(t.vae,[o,s,i],c)}function qi(t,e){var n;const r=Le(t,e);if(!r)return;const[i,s,o]=r,a=ve(t.attrs,s);if(!a)return;if(!Rt(a))throw new Error("merge operation is not supported for links");const u=Se(t.eav,[i,s]);if(!u)return;const d=(n=u.values().next())===null||n===void 0?void 0:n.value;if(!d)return;const c=d[2],f=An(c,o),l=[i,s,f,Dn(t,a,d)];B(t.eav,[i,s],new Map([[f,l]]))}function Dt(t,e){var n,r;const[i,s]=e,o=Le(t,[i]);if(!o)return;const[a]=o,u=t.eav.get(a);if(u){for(const c of u.keys()){const f=t.attrs[c];f&&f["on-delete-reverse"]==="cascade"&&G(u.get(c),1).forEach(([l,p,y])=>{var b;return Dt(t,[y,(b=f["reverse-identity"])===null||b===void 0?void 0:b[1]])}),(!s||!f||((n=f["forward-identity"])===null||n===void 0?void 0:n[1])===s)&&(te(t.aev,[c,a]),te(t.eav,[a,c]))}u.size===0&&te(t.eav,[a])}const d=t.vae.get(a)&&G(t.vae.get(a),2);d&&d.forEach(c=>{var f,l,p;const[y,b,g]=c,m=t.attrs[b];(!s||!m||((f=m["reverse-identity"])===null||f===void 0?void 0:f[1])===s)&&(te(t.eav,[y,b,g]),te(t.aev,[b,y,g]),te(t.vae,[g,b,y])),m&&m["on-delete"]==="cascade"&&((l=m["reverse-identity"])===null||l===void 0?void 0:l[1])===s&&Dt(t,[y,(p=m["forward-identity"])===null||p===void 0?void 0:p[1]])}),((r=t.vae.get(a))===null||r===void 0?void 0:r.size)===0&&te(t.vae,[a])}function Un(t,e){const n=Pn(t.attrs,e,t.useDateObjects);Object.keys(n).forEach(r=>{t[r]=n[r]})}function Bi(t,[e]){t.attrs[e.id]=e,xt(t)}function Ln(t){return G(t.eav,3)}function Gi(t,[e]){if(!t.attrs[e])return;const n=Ln(t).filter(([r,i])=>i!==e);delete t.attrs[e],xt(t),Un(t,n)}function Qi(t,[e]){const n=t.attrs[e.id];n&&(t.attrs[e.id]=Object.assign(Object.assign({},n),e),xt(t),Un(t,Ln(t)))}function Hi(t,e){const[n,...r]=e;switch(n){case"add-triple":$n(t,r);break;case"deep-merge-triple":qi(t,r);break;case"retract-triple":xn(t,r);break;case"delete-entity":Dt(t,r);break;case"add-attr":Bi(t,r);break;case"delete-attr":Gi(t,r);break;case"update-attr":Qi(t,r);break;case"restore-attr":break;case"rule-params":break;default:throw new Error(`unhandled transaction action: ${n}`)}}function G(t,e,n=[]){if(!t||e===0)return n;if(e===1){for(const r of t.values())n.push(r);return n}for(const r of t.values())G(r,e-1,n);return n}function nt(t,e,n){var r;const i=[];if(n!=null&&n.hasOwnProperty("$not")){for(const o of e.keys())n.$not!==o&&i.push(e.get(o));return i}if(n!=null&&n.hasOwnProperty("$isNull")){const{attrId:o,isNull:a,reverse:u}=n.$isNull;if(u)for(const d of e.keys()){const c=t.vae.get(d),f=!c||!c.get(o);(a?f:!f)&&i.push(e.get(d))}else{const d=t.aev.get(o);for(const c of e.keys()){const f=!d||((r=d.get(c))===null||r===void 0?void 0:r.get(null))||!d.get(c);(a?f:!f)&&i.push(e.get(c))}}return i}if(n!=null&&n.$comparator)return G(e,1).filter(n.$op);const s=n.in||n.$in||[n];for(const o of s){const a=e.get(o);a&&i.push(a)}return i}function Yi(t,e,n){let r="";return t!==void 0&&(r+="e"),e!==void 0&&(r+="a"),n!==void 0&&(r+="v"),r}function Ji(t,[e,n,r]){var i,s;switch(Yi(e,n,r)){case"e":{const a=t.eav.get(e);return G(a,2)}case"ea":{const a=(i=t.eav.get(e))===null||i===void 0?void 0:i.get(n);return G(a,1)}case"eav":{const a=(s=t.eav.get(e))===null||s===void 0?void 0:s.get(n);return a?nt(t,a,r):[]}case"ev":{const a=t.eav.get(e);if(!a)return[];const u=[];for(const d of a.values())u.push(...nt(t,d,r));return u}case"a":{const a=t.aev.get(n);return G(a,2)}case"av":{const a=t.aev.get(n);if(!a)return[];const u=[];for(const d of a.values())u.push(...nt(t,d,r));return u}case"v":{const a=[];for(const u of t.eav.values())for(const d of u.values())a.push(...nt(t,d,r));return a}default:return G(t.eav,3)}}function Zi(t,e,n){var r;const i={};if(!e)return i;for(const[s,o]of e.entries()){const a=(r=t.eav.get(n))===null||r===void 0?void 0:r.get(o.id),u=G(a,1);for(const d of u)i[s]=d[2]}return i}function fe(t,e,n){var r;return(r=t.attrIndexes.forwardIdents.get(e))===null||r===void 0?void 0:r.get(n)}function Fn(t,e,n){var r;return(r=t.attrIndexes.revIdents.get(e))===null||r===void 0?void 0:r.get(n)}function Xi(t,e){return t.attrIndexes.blobAttrs.get(e)}function Nn(t,e){var n;const r=t.attrIndexes.primaryKeys.get(e);return r||((n=t.attrIndexes.forwardIdents.get(e))===null||n===void 0?void 0:n.get("id"))}function es(t,e){const n=Le(t,e);if(!n)return;const[r,i,s]=n;if(ve(t.attrs,i))return Se(t.eav,[r,i])}function ts(t,e){const n=e.filter(([r,i,s,o,a])=>{if(r!=="add-triple"&&r!=="deep-merge-triple")return!0;const u=a==null?void 0:a.mode;if(u!=="create"&&u!=="update")return!0;let d=!1;const c=ve(t.attrs,s);if(c){const f=Nn(t,c["forward-identity"][1]);d=!!es(t,[i,f==null?void 0:f.id,i])}return!(u==="create"&&d||u==="update"&&!d)});return Ze(t,r=>{n.forEach(i=>{Hi(r,i)})})}function ns(t){return typeof t=="string"&&t.startsWith("?")}function rs(t,e,n){if(n.hasOwnProperty(t)){const r=n[t];return zn(r,e,n)}return Object.assign(Object.assign({},n),{[t]:e})}function Kn(t,e,n){return t===e?n:null}function is(t){switch(typeof t){case"string":return t.startsWith("?")?rs:Kn;default:return Kn}}const ss=["in","$in","$not","$isNull","$comparator"];function os(t){for(const e of ss)if(t.hasOwnProperty(e))return!0;return!1}function zn(t,e,n){return n?typeof t=="object"?os(t)?n:null:is(t)(t,e,n):null}function as(t,e,n){return t.reduce((r,i,s)=>{const o=e[s];return zn(i,o,r)},n)}function us(t,e,n){return fs(t,e,n).map(r=>as(e,r,n)).filter(r=>r)}function cs(t,e,n){return e.or?e.or.patterns.flatMap(r=>$t(t,r,n)):e.and?e.and.patterns.reduce((r,i)=>$t(t,i,r),n):n.flatMap(r=>us(t,e,r))}function $t(t,e,n=[{}]){return e.reduce((r,i)=>cs(t,i,r),n)}function Ut(t,e){return Array.isArray(e)?e.map(n=>Ut(t,n)):ns(e)?t[e]:e}function ds(t,{find:e,where:n}){return $t(t,n).map(i=>Ut(i,e))}function fs(t,e,n){return Ji(t,Ut(n,e))}const ls=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Oe(t){return typeof t=="string"&&ls.test(t)}const K=[];for(let t=0;t<256;++t)K.push((t+256).toString(16).slice(1));function hs(t,e=0){return(K[t[e+0]]+K[t[e+1]]+K[t[e+2]]+K[t[e+3]]+"-"+K[t[e+4]]+K[t[e+5]]+"-"+K[t[e+6]]+K[t[e+7]]+"-"+K[t[e+8]]+K[t[e+9]]+"-"+K[t[e+10]]+K[t[e+11]]+K[t[e+12]]+K[t[e+13]]+K[t[e+14]]+K[t[e+15]]).toLowerCase()}let Lt;const ps=new Uint8Array(16);function ys(){if(!Lt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Lt=crypto.getRandomValues.bind(crypto)}return Lt(ps)}const Vn={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function bs(t,e,n){var i;if(Vn.randomUUID&&!t)return Vn.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??ys();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,hs(r)}function Wn(t){const e=t.replace(/-/g,""),n=[];for(let r=0;r<e.length;r+=2)n.push(parseInt(e.substring(r,r+2),16));return n}function _s(t,e){for(let n=0;n<t.length;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return 0}function gs(t,e){return _s(Wn(t),Wn(e))}function F(){return bs()}function Ts(t,e){return t.localeCompare(e)}function ms(){let t=Ts;if(typeof Intl=="object"&&Intl.hasOwnProperty("Collator"))try{t=Intl.Collator("en-US").compare}catch{}return t}const ws=ms();let vs=0;function Fe(t){return rt(`_${t}`,vs++)}function rt(t,e){return`?${t}-${e}`}class Ee extends Error{constructor(e){super(e),this.name="AttrNotFoundError"}}function Ss(t,e){const n=Nn(t,e);if(!n)throw new Ee(`Could not find id attr for ${e}`);return n}function qn(t,e,n,r){return[Os(t,e,n,r)]}function Os(t,e,n,r){return[t(n,r),Ss(e,n).id,t(n,r),t("time",r)]}function Es(t,e,n){return t.map(r=>r===e?n:r)}function Bn(t,e,n,r,i){const s=fe(e,n,i),o=Fn(e,n,i),a=s||o;if(!a)throw new Ee(`Could not find attr for ${[n,i]}`);if(a["value-type"]!=="ref")throw new Error(`Attr ${a.id} is not a ref`);const[u,d]=a["forward-identity"],[c,f]=a["reverse-identity"],l=r+1,p=s?[t(d,r),a.id,t(f,l),Fe("time")]:[t(d,l),a.id,t(f,r),Fe("time")];return[s?f:d,l,p,a,!!s]}function Gn(t,e){if(typeof e!="string")return function(o){return!1};const r=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/%/g,".*").replace(/_/g,"."),i=new RegExp(`^${r}$`,t?void 0:"i");return function(o){return typeof o!="string"?!1:i.test(o)}}function As(t,e){if(typeof e!="object"||e.hasOwnProperty("$in")||e.hasOwnProperty("in"))return e;const n=t["checked-data-type"]==="date";if(e.hasOwnProperty("$gt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>new Date(e.$gt)}:function(i){return i[2]>e.$gt}};if(e.hasOwnProperty("$gte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])>=new Date(e.$gte)}:function(i){return i[2]>=e.$gte}};if(e.hasOwnProperty("$lt"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<new Date(e.$lt)}:function(i){return i[2]<e.$lt}};if(e.hasOwnProperty("$lte"))return{$comparator:!0,$op:n?function(i){return new Date(i[2])<=new Date(e.$lte)}:function(i){return i[2]<=e.$lte}};if(e.hasOwnProperty("$like")){const r=Gn(!0,e.$like);return{$comparator:!0,$op:function(s){return r(s[2])}}}if(e.hasOwnProperty("$ilike")){const r=Gn(!1,e.$ilike);return{$comparator:!0,$op:function(s){return r(s[2])}}}return e}function ks(t,e,n,r,i,s){const o=fe(e,n,i),a=Fn(e,n,i),u=o||a;if(!u)throw new Ee(`No attr for etype = ${n} label = ${i}`);if(s!=null&&s.hasOwnProperty("$isNull")){const d=fe(e,n,"id");if(!d)throw new Ee(`No attr for etype = ${n} label = id`);return[t(n,r),d.id,{$isNull:{attrId:u.id,isNull:s.$isNull,reverse:!o}},Fe("time")]}return o?[t(n,r),u.id,As(u,s),Fe("time")]:[s,u.id,t(n,r),Fe("time")]}function js(t,e,n,r,i){const[s,o,a]=i.reduce((u,d)=>{const[c,f,l]=u,[p,y,b]=Bn(t,e,c,f,d);return[p,y,[...l,b]]},[n,r,[]]);return[s,o,a]}function Ft(t,e,n,r,i,s){const o=i.slice(0,i.length-1),a=i[i.length-1],[u,d,c]=js(t,e,n,r,o),f=ks(t,e,u,d,a,s);return c.concat([f])}function Cs(t,e){return e?[e].concat(t):t}function Ps([t,e]){return t==="or"&&Array.isArray(e)}function Is([t,e]){return t==="and"&&Array.isArray(e)}function Ms(t,e,n){return(r,i)=>{const s=t(r,i);return e==s?s:`${s}-${n}`}}function Qn(t,e,n,r,i,s){const o=t(r,i),a=s.map((u,d)=>{const c=Ms(t,o,d);return Yn(c,n,r,i,u)});return{[e]:{patterns:a,joinSym:o}}}function Rs(t){const e=[];for(let n=1;n<=t.length;n++)e.push(t.slice(0,n));return e}function Hn(t,e,n,r,i){return Rs(i).map(s=>Ft(t,e,n,r,s,{$isNull:!0}))}function Yn(t,e,n,r,i){return Object.entries(i).flatMap(([s,o])=>{if(Ps([s,o]))return Qn(t,"or",e,n,r,o);if(Is([s,o]))return Qn(t,"and",e,n,r,o);if(s==="$entityIdStartsWith")return[];const a=s.split(".");if(o!=null&&o.hasOwnProperty("$ne")&&(o=Object.assign(Object.assign({},o),{$not:o.$ne}),delete o.$ne),o!=null&&o.hasOwnProperty("$not")){const u=Ft(t,e,n,r,a,o),d=Hn(t,e,n,r,a);return[{or:{patterns:[u,...d],joinSym:t(n,r)}}]}return o!=null&&o.hasOwnProperty("$isNull")&&o.$isNull===!0&&a.length>1?[{or:{patterns:Hn(t,e,n,r,a),joinSym:t(n,r)}}]:Ft(t,e,n,r,a,o)})}function xs(t,e,n,r){const i=rt;return r?Yn(i,t,e,n,r).concat(qn(i,t,e,n)):qn(i,t,e,n)}function Ds(t,e,n){return[t(e,n),t("time",n)]}function $s(t,e,n,r,i,s){const[o,a,u,d,c]=Bn(t,e,n,r,i),f=Es(u,t(n,r),s);return[o,a,f,d,c]}function Us(t,e,{etype:n,level:r,form:i},s){const o=Object.keys(i).filter(a=>a!=="$");return o.length?Object.entries(s).map(function([u,d]){return o.map(function(l){var p,y,b;const g=!!(e.cardinalityInference&&(!((b=(y=(p=e.linkIndex)===null||p===void 0?void 0:p[n])===null||y===void 0?void 0:y[l])===null||b===void 0)&&b.isSingular));try{const[m,T,v]=$s(t,e,n,r,l,u),C=Zn(e,{etype:m,level:T,form:i[l],join:v}),S=g?C[0]:C;return{[l]:S}}catch(m){if(m instanceof Ee)return{[l]:g?void 0:[]};throw m}}).reduce(function(l,p){return Object.assign(Object.assign({},l),p)},d)}):Object.values(s)}function Ls(t,e,n){return n==="string"?ws(t,e):t>e?1:-1}function Ne(t,e,n,r,i){return e===r||e==null&&r==null?gs(t,n):r==null?1:e==null?-1:Ls(e,r,i)}function it([t,e],[n,r],i){return Ne(t,e,n,r,i)}function Nt(t){return t==null?t:new Date(t).getTime()}function Fs(t,e,n,r){var i;const[s,o,a,u]=t,d=n==="desc"?1:-1;if(((i=e["forward-identity"])===null||i===void 0?void 0:i[2])==="id")return it(r,[s,u],null)===d;const[c,f]=r,l=e["checked-data-type"],p=l==="date"?Nt(f):f,y=l==="date"?Nt(a):a;return it([c,p],[s,y],l)===d}function Ns(t,e){const n=e[1];return t.attrs[n]}function Ks(t,e,n){const r=Object.keys(n)[0];return fe(t,e,r)}function zs(t,e,n,r){if(n)return Ns(t,n);if(r)return Ks(t,e,r)}function Vs(t,e,n){var r,i;if(!Array.isArray(n.fields))return Xi(t,e);const s=new Map;for(const o of n.fields){const a=fe(t,e,o),u=(r=a==null?void 0:a["forward-identity"])===null||r===void 0?void 0:r[2];u&&Rt(a)&&s.set(u,a)}if(!s.has("id")){const o=fe(t,e,"id"),a=(i=o==null?void 0:o["forward-identity"])===null||i===void 0?void 0:i[2];a&&s.set(a,o)}return s}function Ws(t,{etype:e,pageInfo:n,dq:r,form:i}){var s,o;const a=(s=i==null?void 0:i.$)===null||s===void 0?void 0:s.order,u=Jn(i),d=qs(i);let c=ds(t,r);const f=n==null?void 0:n["start-cursor"],l=zs(t,e,f,a);if(l&&((o=l==null?void 0:l["forward-identity"])===null||o===void 0?void 0:o[2])!=="id"){const b=l["checked-data-type"]==="date",g=l.id;c=c.map(([m])=>{var T,v,C,S,R;let x=(R=(S=(C=(v=(T=t.eav.get(m))===null||T===void 0?void 0:T.get(g))===null||v===void 0?void 0:v.values())===null||C===void 0?void 0:C.next())===null||S===void 0?void 0:S.value)===null||R===void 0?void 0:R[2];return b&&(x=Nt(x)),[m,x]})}c.sort(d==="asc"?function(g,m){return it(g,m,l==null?void 0:l["checked-data-type"])}:function(g,m){return it(m,g,l==null?void 0:l["checked-data-type"])});let p={};const y=Vs(t,e,r);for(const b of c){const[g]=b;if(p[g]||!u&&f&&l&&Fs(f,l,d,b))continue;const m=Zi(t,y,g);m&&(p[g]=m)}return p}function qs(t){var e;const n=(e=t.$)===null||e===void 0?void 0:e.order;return n&&n[Object.keys(n)[0]]||"asc"}function Jn(t){var e,n,r;const i=(e=t.$)===null||e===void 0?void 0:e.offset,s=(n=t.$)===null||n===void 0?void 0:n.before,o=(r=t.$)===null||r===void 0?void 0:r.after;return!i&&!s&&!o}function Bs(t,{etype:e,level:n,form:r,join:i,pageInfo:s}){var o,a,u,d,c;if(!Jn(r)&&(!s||!s["start-cursor"]))return[];const f=Cs(xs(t,e,n,(o=r.$)===null||o===void 0?void 0:o.where),i),l=Ds(rt,e,n),p=(a=r.$)===null||a===void 0?void 0:a.fields,y=Ws(t,{etype:e,pageInfo:s,form:r,dq:{where:f,find:l,fields:p}}),b=((u=r.$)===null||u===void 0?void 0:u.limit)||((d=r.$)===null||d===void 0?void 0:d.first)||((c=r.$)===null||c===void 0?void 0:c.last);if(b!=null){n>0&&console.warn("WARNING: Limits in child queries are only run client-side. Data returned from the server will not have a limit.");const g=Object.entries(y);return g.length<=b?y:Object.fromEntries(g.slice(0,b))}return y}function Gs(t,e){try{return Bs(t,e)}catch(n){if(n instanceof Ee)return{};throw n}}function Zn(t,e){const n=Gs(t,e);return Us(rt,t,e,n)}function Qs(t){const e={};for(const[n,r]of Object.entries(t))e[n]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return e}function Xn({store:t,pageInfo:e,aggregate:n},r){const s={data:Object.keys(r).reduce(function(a,u){return n!=null&&n[u]||u==="$$ruleParams"||(a[u]=Zn(t,{etype:u,form:r[u],level:0,pageInfo:e==null?void 0:e[u]})),a},{})};return e&&(s.pageInfo=Qs(e)),n&&(s.aggregate=n),s}function Hs(){const e={__etype:1,__ops:1,create:1,update:1,link:1,unlink:1,delete:1,merge:1,ruleParams:1};return new Set(Object.keys(e))}const Ys=Hs();function Kt(t,e,n){const r={__etype:t,__ops:n};return new Proxy(r,{get:(i,s)=>{if(s==="__ops")return n;if(s==="__etype")return t;if(Ys.has(s))return(o,a)=>Kt(t,e,[...n,a?[s,t,e,o,a]:[s,t,e,o]])}})}function st(t){return t.startsWith("lookup__")}function er(t){const[e,n,...r]=t.split("__");return[n,JSON.parse(r.join("__"))]}function Js(t){return new Proxy({__etype:t},{get(e,n){if(n==="__etype")return t;const r=n;return st(r)?Kt(t,er(r),[]):Kt(t,r,[])}})}function zt(){return new Proxy({},{get(t,e){return Js(e)}})}zt();function Zs(t){return t.__ops}function Xs(t,e){const{attrIdMap:n,refSwapAttrIds:r}=t,i=[];for(const o of e){const a=n[o];if(a)i.push(a);else if(Array.isArray(o)&&o.length==2&&n[o[0]]){const[u,d]=o;i.push([n[u],d])}else i.push(o)}const[s]=e;if((s==="add-triple"||s==="retract-triple")&&r.has(e[2])){const o=i[1];i[1]=i[3],i[3]=o}return i}function z(t,e,n){return Object.values(t).find(r=>{const[i,s,o]=r["forward-identity"];return s===e&&o===n})}function be(t,e,n){return Object.values(t).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[s,o,a]=i;return o===e&&a===n})}function eo(t){if(Array.isArray(t))return t;const e=Object.entries(t);if(e.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return e[0]}function Vt(t,e,n){return n.indexOf(".")!==-1&&!z(t,e,n)}function Wt(t){const[e,n,...r]=t.split(".");if(r.length>0||n!=="id")throw new Error(`${t} is not a valid lookup attribute.`);return e}function to(t,e,n){if(!Vt(t,e,n))return z(t,e,n);const r=Wt(n),i=z(t,e,r)||be(t,e,r);if(i&&i["value-type"]!=="ref")throw new Error(`${n} does not reference a valid link attribute.`);return i}function qt(t){return typeof t=="string"&&!st(t)?null:typeof t=="string"&&st(t)?er(t):eo(t)}function Q(t,e,n){const r=qt(n);if(r===null)return n;const[i,s]=r,o=to(t,e,i);if(!o||!o["unique?"])throw new Error(`${i} is not a unique attribute.`);return[o.id,s]}function tr(t,e,n,r){const i=Q(t,e,n);return Array.isArray(i)?[["add-triple",i,z(t,e,"id").id,i]].concat(r):r}function no({attrs:t},[e,n,r]){const i=Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],u=z(t,e,s),d=be(t,e,s);return a.map(c=>u?["add-triple",Q(t,e,n),u.id,Q(t,u["reverse-identity"][1],c)]:["add-triple",Q(t,d["forward-identity"][1],c),d.id,Q(t,e,n)])});return tr(t,e,n,i)}function ro({attrs:t},[e,n,r]){const i=Object.entries(r).flatMap(([s,o])=>{const a=Array.isArray(o)?o:[o],u=z(t,e,s),d=be(t,e,s);return a.map(c=>u?["retract-triple",Q(t,e,n),u.id,Q(t,u["reverse-identity"][1],c)]:["retract-triple",Q(t,d["forward-identity"][1],c),d.id,Q(t,e,n)])});return tr(t,e,n,i)}function io(t,e,n){if(Array.isArray(n)){const[r,i]=n;for(const s of t||[]){const o=s==null?void 0:s.aev.get(r);if(o){for(const[a,u,d]of G(o,2))if(d===i)return!0}}}else for(const r of t||[]){const i=r==null?void 0:r.eav.get(n);if(i){for(const s of i.keys())if(r.attrs[s]["forward-identity"][1]==e)return!0}}return!1}function nr({stores:t,attrs:e},[n,r,i,s]){return(s==null?void 0:s.upsert)===!1?{mode:"update"}:(s==null?void 0:s.upsert)===!0?null:io(t,n,r)?{mode:"update"}:null}function so(t,e){const{stores:n,attrs:r}=t,[i,s,o,a]=e,u=Pt(o),d=Q(r,i,s);return[["id",d]].concat(Object.entries(u)).map(([f,l])=>{const p=z(r,i,f);return p["checked-data-type"]==="date"&&t.useDateObjects&&(l=et(l)),["add-triple",d,p.id,l,{mode:"create"}]})}function oo(t,e){const{stores:n,attrs:r}=t,[i,s,o,a]=e,u=Pt(o),d=Q(r,i,s),c=nr(t,[i,d,o,a]);return[["id",d]].concat(Object.entries(u)).map(([l,p])=>{const y=z(r,i,l);return y["checked-data-type"]==="date"&&t.useDateObjects&&(p=et(p)),["add-triple",d,y.id,p,...c?[c]:[]]})}function ao({attrs:t},[e,n]){return[["delete-entity",Q(t,e,n),e]]}function uo(t,e){const{stores:n,attrs:r}=t,[i,s,o,a]=e,u=Pt(o),d=Q(r,i,s),c=nr(t,[i,d,o,a]),f=Object.entries(u).map(([p,y])=>{const b=z(r,i,p);return["deep-merge-triple",d,b.id,y,...c?[c]:[]]});return[["add-triple",d,z(r,i,"id").id,d,...c?[c]:[]]].concat(f)}function co({attrs:t},[e,n,r]){return[["rule-params",Q(t,e,n),e,r]]}function fo(t){const[e,n,r,i,s]=t;if(!i)return t;const o=Object.assign({},i);return delete o.id,[e,n,r,o,...s?[s]:[]]}function lo(t,e){const[n,...r]=fo(e);switch(n){case"merge":return uo(t,r);case"create":return so(t,r);case"update":return oo(t,r);case"link":return no(t,r);case"unlink":return ro(t,r);case"delete":return ao(t,r);case"ruleParams":return co(t,r);default:throw new Error(`unsupported action ${n}`)}}function ho(t){switch(t){case"string":case"date":case"boolean":case"number":return t;default:return}}function po(t,e,n){var r,i;const s=(i=(r=t.entities[e])===null||r===void 0?void 0:r.attrs)===null||i===void 0?void 0:i[n];if(n==="id")return null;if(!s)throw new Error(`${e}.${n} does not exist in your schema`);const{unique:o,indexed:a}=s==null?void 0:s.config,u=ho(s==null?void 0:s.valueType);return{"index?":a,"unique?":o,"checked-data-type":u}}function ot(t,e,n,r){const i=t?po(t,e,n):null,s=F(),a=[F(),e,n];return Object.assign(Object.assign({id:s,"forward-identity":a,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}function yo(t,e,n){return Object.values(t.links).find(i=>i.forward.on===e&&i.forward.label===n||i.reverse.on===e&&i.reverse.label===n)}function bo(t,e,n){const r=yo(t,e,n);if(!r)throw new Error(`Couldn't find the link ${e}.${n} in your schema`);const{forward:i,reverse:s}=r;return{"forward-identity":[F(),i.on,i.label],"reverse-identity":[F(),s.on,s.label],cardinality:i.has==="one"?"one":"many","unique?":s.has==="one","on-delete":i.onDelete,"on-delete-reverse":s.onDelete}}function rr(t,e,n,r){const i=t?bo(t,e,n):null,s=F(),o=[F(),e,n],a=[F(),n,e];return Object.assign(Object.assign({id:s,"forward-identity":o,"reverse-identity":a,"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},i||{}),r||{})}const _o=new Set(["create","update","merge","link","unlink"]),go=new Set(["link","unlink"]),To=new Set(["create","update","merge"]),mo=new Set(["link","unlink","create","update","merge","delete","ruleParams"]),Bt={"unique?":!0,"index?":!0},wo=Object.assign(Object.assign({},Bt),{cardinality:"one"});function vo(t){const e=[],[n,r,i,s]=t;if(!mo.has(n))return e;const o=qt(i);if(o&&e.push({etype:r,lookupPair:o}),n==="link")for(const[a,u]of Object.entries(s)){const d=Array.isArray(u)?u:[u];for(const c of d){const f=qt(c);f&&e.push({etype:r,lookupPair:f,linkLabel:a})}}return e}function So({attrs:t,schema:e},n){var r,i;const[s,o,a]=[new Set,Object.assign({},t),[]];function u(f){o[f.id]=f,a.push(["add-attr",f]),s.add(f.id)}function d(f){f!=null&&f.isUnsynced&&!s.has(f.id)&&(a.push(["add-attr",f]),s.add(f.id))}function c(f,l){const p=z(o,f,l),y=be(o,f,l);d(p),d(y),!p&&!y&&u(rr(e,f,l,wo))}for(const f of n)for(const{etype:l,lookupPair:p,linkLabel:y}of vo(f)){const b=p[0];if(y){c(l,y);const g=z(o,l,y),m=be(o,l,y);d(g),d(m);const T=((r=g==null?void 0:g["reverse-identity"])===null||r===void 0?void 0:r[1])||((i=m==null?void 0:m["forward-identity"])===null||i===void 0?void 0:i[1])||y;if(Vt(o,T,b))c(T,Wt(b));else{const v=z(o,T,b);v||u(ot(e,T,b,Bt)),d(v)}}else if(Vt(o,l,b))c(l,Wt(b));else{const g=z(o,l,b);g||u(ot(e,l,b,Bt)),d(g)}}for(const f of n){const[l,p,y,b]=f;if(_o.has(l)){const g=z(o,p,"id");d(g),g||u(ot(e,p,"id",{"unique?":!0}));for(const m of Object.keys(b)){const T=z(o,p,m);if(d(T),To.has(l)&&(T||u(ot(e,p,m,m==="id"?{"unique?":!0}:null))),go.has(l)){const v=be(o,p,m);!T&&!v&&u(rr(e,p,m)),d(v)}}}}return[o,a]}function Oo(t,e){const r=(Array.isArray(e)?e:[e]).flatMap(u=>Zs(u)),[i,s]=So(t,r),o=Object.assign(Object.assign({},t),{attrs:i}),a=r.flatMap(u=>lo(o,u));return[...s,...a]}var ie=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};function ir(t,e){typeof requestIdleCallback>"u"?t():requestIdleCallback(t,{timeout:e})}const Ke="__meta";class Eo{constructor(e,n){}}class Gt{constructor(e){var n,r;this._subs=[],this._nextSave=null,this._nextGc=null,this._pendingSaveKeys=new Set,this._loadedKeys=new Set,this._version=0,this._meta={isLoading:!0,onLoadCbs:[],value:null,error:null,attempts:0},this._persister=e.persister,this._merge=e.merge,this.serialize=e.serialize,this.parse=e.parse,this._objectSize=e.objectSize,this._log=e.logger,this._saveThrottleMs=(n=e.saveThrottleMs)!==null&&n!==void 0?n:100,this._idleCallbackMaxWaitMs=(r=e.idleCallbackMaxWaitMs)!==null&&r!==void 0?r:1e3,this._gcOpts=e.gc,this.currentValue={},this._loadedKeys=new Set,this._loadingKeys={},this._initMeta(),e.preloadEntryCount&&this._preloadEntries(e.preloadEntryCount)}_initMeta(){return ie(this,void 0,void 0,function*(){var e,n,r;this._meta.loadingPromise&&(yield this._meta.loadingPromise);try{const i=this._persister.getItem(Ke);this._meta.loadingPromise=i;const s=yield i;this._meta.isLoading=!1,this._meta.error=null,this._meta.loadingPromise=null,this._meta.attempts=0;const o=(n=(e=this._meta.value)===null||e===void 0?void 0:e.objects)!==null&&n!==void 0?n:{},a=s??{},u=(r=a.objects)!==null&&r!==void 0?r:{};this._meta.value=Object.assign(Object.assign({},a),{objects:Object.assign(Object.assign({},o),u)})}catch(i){this._meta.error=i,this._meta.attempts++,this._meta.loadingPromise=null}})}_getMeta(){return ie(this,void 0,void 0,function*(){return this._meta.value?this._meta.value:this._meta.loadingPromise?(yield this._meta.loadingPromise,this._meta.value):(this._initMeta(),yield this._meta.loadingPromise,this._meta.value)})}_refreshMeta(){return ie(this,void 0,void 0,function*(){return yield this._initMeta(),this._meta.value})}_preloadEntries(e){return ie(this,void 0,void 0,function*(){const n=yield this.waitForMetaToLoad();if(!n)return;const r=Object.entries(n.objects);r.sort(([i,s],[o,a])=>a.updatedAt-s.updatedAt);for(const[i]of r.slice(0,e))this._loadKey(i)})}_getFromStorage(e){return ie(this,void 0,void 0,function*(){try{const n=yield this._persister.getItem(e);return n&&this.parse(e,n)}catch(n){return console.error(`Unable to read from storage for key=${e}`,n),null}})}waitForKeyToLoad(e){return ie(this,void 0,void 0,function*(){return this._loadedKeys.has(e)?this.currentValue[e]:(yield this._loadingKeys[e]||this._loadKey(e),this.currentValue[e])})}waitForMetaToLoad(){return ie(this,void 0,void 0,function*(){return this._getMeta()})}unloadKey(e){this._loadedKeys.delete(e),delete this._loadingKeys[e],delete this.currentValue[e]}_loadKey(e){return ie(this,void 0,void 0,function*(){if(this._loadedKeys.has(e)||e in this._loadingKeys)return;const n=this._getFromStorage(e);this._loadingKeys[e]=n;const r=yield n;if(delete this._loadingKeys[e],this._loadedKeys.add(e),r){const i=this._merge(e,r,this.currentValue[e]);i&&(this.currentValue[e]=i)}this.onKeyLoaded&&this.onKeyLoaded(e)})}_writeToStorage(e){var n,r;const i=[],s=e==null?void 0:e.skipGc;if(this._meta.isLoading){const p=new Promise((y,b)=>{var g;setTimeout(()=>this._enqueuePersist(e?Object.assign(Object.assign({},e),{attempts:(e.attempts||0)+1}):{attempts:1}).then(y).catch(b),10+((g=e==null?void 0:e.attempts)!==null&&g!==void 0?g:0)*1e3)});return i.push(p),Promise.all(i).then(y=>y.reduce((b,g)=>b+g,0))}const o=this._meta.value;if(!o)return Promise.resolve(0);const a=[],u=[];for(const p of this._pendingSaveKeys)p in this.currentValue?u.push(p):(a.push(p),delete o.objects[p]);for(const p of a){const y=this._persister.removeItem(p);i.push(y.then(()=>1)),this._loadedKeys.delete(p),this._pendingSaveKeys.delete(p)}const d=[],c=[[Ke,o]],f=(n=o.objects)!==null&&n!==void 0?n:{};o.objects=f;for(const p of u)if(this._loadedKeys.has(p)){const y=this.serialize(p,this.currentValue[p]);c.push([p,y]);const b=this._objectSize(y),g=(r=f[p])!==null&&r!==void 0?r:{createdAt:Date.now(),updatedAt:Date.now(),size:b};g.updatedAt=Date.now(),g.size=b,f[p]=g,this._pendingSaveKeys.delete(p)}else d.push(p);const l=this._persister.multiSet(c);i.push(l.then(()=>1));for(const p of d){const y=this._loadKey(p).then(()=>this._enqueuePersist(e));i.push(y)}return s||this.gc(),Promise.all(i).then(p=>p.reduce((y,b)=>y+b,0))}flush(){return ie(this,void 0,void 0,function*(){return this._nextSave?(clearTimeout(this._nextSave),this._nextSave=null,this._writeToStorage()):void 0})}_gc(){return ie(this,void 0,void 0,function*(){if(!this._gcOpts)return;const e=new Set(yield this._persister.getAllKeys());e.delete(Ke);const n=new Set(Object.keys(this.currentValue));for(const l of Object.keys(this._loadingKeys))n.add(l);for(const l of this._loadedKeys)n.add(l);const r=yield this._refreshMeta();if(!r){this._log.info("Could not gc because we were not able to load meta");return}const i=[],s={gcOpts:this._gcOpts,keys:e,sacredKeys:n,removed:[],metaRemoved:[],removedMissingCount:0,removedOldCount:0,removedThresholdCount:0,removedSizeCount:0};for(const l of e)n.has(l)||l in r.objects||(this._log.info("Lost track of key in meta",l),i.push(this._persister.removeItem(l)),s.removed.push(l),s.removedMissingCount++);const o=Date.now();for(const[l,p]of Object.entries(r.objects))!n.has(l)&&p.updatedAt<o-this._gcOpts.maxAgeMs&&(i.push(this._persister.removeItem(l)),delete r.objects[l],s.removed.push(l),s.removedOldCount++);const a=Object.entries(r.objects);a.sort(([l,p],[y,b])=>p.updatedAt-b.updatedAt);const u=a.filter(([l])=>!n.has(l));if(a.length>this._gcOpts.maxEntries)for(const[l]of u.slice(0,a.length-this._gcOpts.maxEntries))i.push(this._persister.removeItem(l)),delete r.objects[l],s.removed.push(l),s.removedThresholdCount++;const d=Object.entries(r.objects);d.sort(([l,p],[y,b])=>p.updatedAt-b.updatedAt);const c=d.filter(([l])=>!n.has(l));let f=d.reduce((l,[p,y])=>l+y.size,0);for(;f>0&&f>this._gcOpts.maxSize&&c.length;){const[[l,p]]=c.splice(0,1);f-=p.size,i.push(this._persister.removeItem(l)),delete r.objects[l],s.removed.push(l),s.removedSizeCount++}for(const l of Object.keys(r.objects))!e.has(l)&&!n.has(l)&&delete r.objects[l];return(s.removed.length||s.metaRemoved.length)&&i.push(this._enqueuePersist({skipGc:!0})),this._log.info("Completed GC",s),yield Promise.all(i),s})}gc(){this._nextGc||(this._nextGc=setTimeout(()=>{ir(()=>{this._nextGc=null,this._gc()},30*1e3)},1e3*60+Math.random()*500))}_enqueuePersist(e){return new Promise((n,r)=>{if(this._nextSave){n(0);return}this._nextSave=setTimeout(()=>{ir(()=>{this._nextSave=null,this._writeToStorage(e).then(n).catch(r)},this._idleCallbackMaxWaitMs)},this._saveThrottleMs)})}version(){return this._version}updateInPlace(e){this._version++;const[n,r]=Ze(this.currentValue,e,{enablePatches:!0});for(const i of r){const s=i.path[0];s&&typeof s=="string"&&(this._pendingSaveKeys.add(s),this._loadedKeys.has(s)||this._loadKey(s))}this.currentValue=n,this._enqueuePersist();for(const i of this._subs)i(this.currentValue);return n}subscribe(e){return this._subs.push(e),e(this.currentValue),()=>{this._subs=this._subs.filter(n=>n!==e)}}}var ue=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};const Ao=6,ko=["kv","querySubs","syncSubs"];function jo(t){return function(n){console.error("Error in IndexedDB event",{source:t,event:n})}}function Co(t){return ue(this,void 0,void 0,function*(){return new Promise(e=>{const n=indexedDB.open(t);n.onerror=r=>{e(null)},n.onsuccess=r=>{const s=r.target.result;e(s)},n.onupgradeneeded=r=>{var i;(i=r.target.transaction)===null||i===void 0||i.abort(),e(null)}})})}function Po(t,e,n){return ue(this,void 0,void 0,function*(){const r=typeof e=="string"?JSON.parse(e):e;if(!r)return;const i=new Set;return new Promise((s,o)=>{var a,u,d,c;const f={};for(const[y,b]of Object.entries(r)){const g=typeof b=="string"?JSON.parse(b):b;if(g.lastAccessed){const T={createdAt:g.lastAccessed,updatedAt:g.lastAccessed,size:(c=(d=(u=(a=g.result)===null||a===void 0?void 0:a.store)===null||u===void 0?void 0:u.triples)===null||d===void 0?void 0:d.length)!==null&&c!==void 0?c:0};f[y]=T}const m=n.put(g,y);i.add(m)}const l={objects:f},p=n.put(l,Ke);i.add(p);for(const y of i)y.onsuccess=()=>{i.delete(y),i.size===0&&s()},y.onerror=b=>{o(b)}})})}function sr(t,e,n){return ue(this,void 0,void 0,function*(){const r=n.put(e,t);return new Promise((i,s)=>{r.onsuccess=()=>i(),r.onerror=o=>s(o)})})}function Io(t,e){return ue(this,void 0,void 0,function*(){const n=yield Co(`instant_${t}_5`);if(!n)return;const r=yield new Promise((c,f)=>{const y=n.transaction(["kv"],"readonly").objectStore("kv").openCursor();y.onerror=g=>{f(g)};const b=[];y.onsuccess=()=>{const g=y.result;if(g){const m=g.key,T=g.value;b.push([m,T]),g.continue()}else c(b)},y.onerror=g=>{f(g)}}),i=e.transaction(["kv","querySubs"],"readwrite"),s=i.objectStore("kv"),o=i.objectStore("querySubs"),a=[],u={objects:{}};for(const[c,f]of r)switch(c){case"querySubs":{const l=Po(c,f,o);a.push(l);break}default:{const l=sr(c,f,s);a.push(l);const p={createdAt:Date.now(),updatedAt:Date.now(),size:0};u.objects[c]=p;break}}const d=sr(Ke,u,s);a.push(d),yield Promise.all(a),yield new Promise((c,f)=>{i.oncomplete=l=>c(l),i.onerror=l=>f(l),i.onabort=l=>f(l)})})}const or=new Map;class ar extends Eo{constructor(e,n){super(e,n),this.dbName=`instant_${e}_${Ao}`,this._storeName=n,this._appId=e,this._dbPromise=this._init()}_init(){return new Promise((e,n)=>{let r=!1;const i=indexedDB.open(this.dbName,1);i.onerror=s=>{n(s)},i.onsuccess=s=>{const a=s.target.result;if(r){const u=Io(this._appId,a).catch(d=>{jo("Error upgrading store from version 5 to 6.")(d)});or.set(this.dbName,u),u.then(()=>e(a)).catch(()=>e(a))}else{const u=or.get(this.dbName);u?u.then(()=>e(a)).catch(()=>e(a)):e(a)}},i.onupgradeneeded=s=>{r=!0,this._upgradeStore(s)}})}_upgradeStore(e){const r=e.target.result;for(const i of ko)r.objectStoreNames.contains(i)||r.createObjectStore(i)}getItem(e){return ue(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const a=n.transaction([this._storeName],"readonly").objectStore(this._storeName).get(e);a.onerror=u=>{i(u)},a.onsuccess=u=>{a.result?r(a.result):r(null)}})})}setItem(e,n){return ue(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,s)=>{const u=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(n,e);u.onerror=d=>{s(d)},u.onsuccess=d=>{i()}})})}multiSet(e){return ue(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const s=n.transaction([this._storeName],"readwrite"),o=s.objectStore(this._storeName),a=new Set;for(const[u,d]of e){const c=o.put(d,u);a.add(c)}for(const u of a)u.onerror=d=>{s.abort(),i(d)},u.onsuccess=d=>{a.delete(u),a.size===0&&r()}})})}removeItem(e){return ue(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const a=n.transaction([this._storeName],"readwrite").objectStore(this._storeName).delete(e);a.onerror=u=>{i(u)},a.onsuccess=u=>{r()}})})}getAllKeys(){return ue(this,void 0,void 0,function*(){const e=yield this._dbPromise;return new Promise((n,r)=>{const o=e.transaction([this._storeName],"readonly").objectStore(this._storeName).getAllKeys();o.onerror=a=>{r(a)},o.onsuccess=a=>{n(o.result.filter(u=>typeof u=="string"))}})})}}var Mo=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};class ur{static getIsOnline(){return Mo(this,void 0,void 0,function*(){return navigator.onLine})}static listen(e){const n=()=>{e(!0)},r=()=>{e(!1)};return addEventListener("online",n),addEventListener("offline",r),()=>{removeEventListener("online",n),removeEventListener("offline",r)}}}class Ae extends Error{constructor(e,n){super(e),this.hint=n;const r=new.target.prototype;Object.setPrototypeOf&&Object.setPrototypeOf(this,r),Error.captureStackTrace&&Error.captureStackTrace(this,Ae),this.name="InstantError"}get[Symbol.toStringTag](){return"InstantError"}}var Ro=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};class at extends Ae{constructor(e){var n;const r=((n=e.body)===null||n===void 0?void 0:n.message)||`API Error (${e.status})`;super(r,e.body.hint);const i=new.target.prototype;Object.setPrototypeOf&&Object.setPrototypeOf(this,i),Error.captureStackTrace&&Error.captureStackTrace(this,at),this.name="InstantAPIError",this.status=e.status,this.body=e.body}get[Symbol.toStringTag](){return"InstantAPIError"}}function ne(t,e){return Ro(this,void 0,void 0,function*(){const n=yield fetch(t,e),r=yield n.json();return n.status===200?Promise.resolve(r):Promise.reject(new at({status:n.status,body:r}))})}var ke=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};function xo({apiURI:t,appId:e,email:n}){return ne(`${t}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:n})})}function Do(t){return ke(this,arguments,void 0,function*({apiURI:e,appId:n,email:r,code:i,refreshToken:s}){return yield ne(`${e}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(Object.assign({"app-id":n,email:r,code:i},s?{"refresh-token":s}:{}))})})}function $o(t){return ke(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield ne(`${e}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,"refresh-token":r})})})}function Uo(t){return ke(this,arguments,void 0,function*({apiURI:e,appId:n}){return yield ne(`${e}/runtime/auth/sign_in_guest`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n})})})}function cr(t){return ke(this,arguments,void 0,function*({apiURI:e,appId:n,code:r,codeVerifier:i,refreshToken:s}){return yield ne(`${e}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,code:r,code_verifier:i,refresh_token:s})})})}function Lo(t){return ke(this,arguments,void 0,function*({apiURI:e,appId:n,nonce:r,idToken:i,clientName:s,refreshToken:o}){return yield ne(`${e}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,nonce:r,id_token:i,client_name:s,refresh_token:o})})})}function Fo(t){return ke(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield ne(`${e}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,refresh_token:r})})})}var ze=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};function No(t){return ze(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,file:i,refreshToken:s,contentType:o,contentDisposition:a}){const u={app_id:n,path:r,authorization:`Bearer ${s}`,"content-type":o||i.type};return a&&(u["content-disposition"]=a),yield ne(`${e}/storage/upload`,{method:"PUT",headers:u,body:i})})}function Ko(t){return ze(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:s}=yield ne(`${e}/storage/files?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}function zo(t){return ze(this,arguments,void 0,function*({apiURI:e,appId:n,fileName:r,refreshToken:i,metadata:s={}}){const{data:o}=yield ne(`${e}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:n,filename:r})});return o})}function Vo(t,e){return ze(this,void 0,void 0,function*(){return(yield fetch(t,{method:"PUT",body:e,headers:{"Content-Type":e.type}})).ok})}function Wo(t){return ze(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:s}=yield ne(`${e}/storage/signed-download-url?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return s})}let Qt=!1,dr=!1,fr=!1;typeof window<"u"&&typeof window.localStorage<"u"&&(Qt=!!window.localStorage.getItem("devBackend"),dr=!!window.localStorage.getItem("__instantLogging"),fr=!!window.localStorage.getItem("__devtoolLocalDash"));function lr(t,e){if(!e)return t;const n={};return e.forEach(r=>{n[r]=t[r]}),n}function qo(t,e,n){var r,i;const s={peers:{}};if(e&&"user"in e?e.user:!0){const a=lr((r=t.user)!==null&&r!==void 0?r:{},e==null?void 0:e.keys);s.user=Object.assign(Object.assign({},a),{peerId:n})}for(const a of Object.keys((i=t.peers)!==null&&i!==void 0?i:{})){const u=(e==null?void 0:e.peers)===void 0,d=Array.isArray(e==null?void 0:e.peers)&&(e==null?void 0:e.peers.includes(a));if(u||d){const c=lr(t.peers[a],e==null?void 0:e.keys);s.peers[a]=Object.assign(Object.assign({},c),{peerId:a})}}return s}function Bo(t,e){if(t.isLoading!==e.isLoading||t.error!==e.error||(t.user||e.user)&&(!t.user||!e.user||!En(t.user,e.user))||!On(t.peers,e.peers))return!0;for(const r of Object.keys(t.peers))if(!En(t.peers[r],e.peers[r]))return!0;return!1}class hr{constructor(){this.promise=new Promise((e,n)=>{this._resolve=e,this._reject=n})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}function pr(t,e=[]){t.forEach(n=>{const{data:r}=n,{"datalog-result":i}=r,{"join-rows":s}=i;for(const o of s)for(const a of o)e.push(a);pr(n["child-nodes"],e)})}function yr(t){const e=[];return pr(t,e),e}function br(t){return Object.values(t.links).reduce((e,n)=>{var r,i,s,o;return(r=e[s=n.forward.on])!==null&&r!==void 0||(e[s]={}),e[n.forward.on][n.forward.label]={isForward:!0,isSingular:n.forward.has==="one",link:n},(i=e[o=n.reverse.on])!==null&&i!==void 0||(e[o]={}),e[n.reverse.on][n.reverse.label]={isForward:!1,isSingular:n.reverse.has==="one",link:n},e},{})}const _r="v0.22.88";function Go(t,e){return{info:t?(...n)=>console.info(...n,e()):()=>{},debug:t?(...n)=>console.debug(...n,e()):()=>{},error:t?(...n)=>console.error(...n,e()):()=>{}}}class ce{constructor(e,n,r,i={indexed:!1,unique:!1}){this.valueType=e,this.required=n,this.isIndexed=r,this.config=i,this.metadata={}}clientRequired(){return new ce(this.valueType,!1,this.isIndexed,this.config)}optional(){return new ce(this.valueType,!1,this.isIndexed,this.config)}unique(){return new ce(this.valueType,this.required,this.isIndexed,Object.assign(Object.assign({},this.config),{unique:!0}))}indexed(){return new ce(this.valueType,this.required,!0,Object.assign(Object.assign({},this.config),{indexed:!0}))}}class M extends Error{constructor(e,n){const r=n?`At path '${n}': ${e}`:e;super(r),this.name="QueryValidationError"}}const gr=["where","order","limit","last","first","offset","after","before","fields","aggregate"],Qo=t=>t.valueType||"unknown",Tr=(t,e,n=!1)=>{if(n||t==null)return!0;switch(e){case"string":return typeof t=="string";case"number":return typeof t=="number"&&!isNaN(t);case"boolean":return typeof t=="boolean";case"date":return t instanceof Date||typeof t=="string"||typeof t=="number";default:return!0}},Ho=(t,e,n,r,i,s,o)=>{const a=s.valueType==="json",u=(d,c,f)=>{if(!Tr(f,c,a))throw new M(`Invalid value for operator '${d}' on attribute '${r}' in entity '${i}'. Expected ${c}, but received: ${typeof f}`,o)};switch(t){case"in":case"$in":if(!Array.isArray(e))throw new M(`Operator '${t}' for attribute '${r}' in entity '${i}' must be an array, but received: ${typeof e}`,o);for(const d of e)u(t,n,d);break;case"$not":case"$ne":case"$gt":case"$lt":case"$gte":case"$lte":u(t,n,e);break;case"$like":case"$ilike":if(u(t,"string",e),t==="$ilike"&&!s.isIndexed)throw new M(`Operator '${t}' can only be used with indexed attributes, but '${r}' in entity '${i}' is not indexed`,o);break;case"$isNull":u(t,"boolean",e);break;default:throw new M(`Unknown operator '${t}' for attribute '${r}' in entity '${i}'`,o)}},je=(t,e,n,r,i)=>{const s=Qo(n),o=n.valueType==="json";if(typeof t=="object"&&t!==null&&!Array.isArray(t)){if(o)return;const u=t;for(const[d,c]of Object.entries(u))Ho(d,c,s,e,r,n,`${i}.${d}`)}else if(!Tr(t,s,o))throw new M(`Invalid value for attribute '${e}' in entity '${r}'. Expected ${s}, but received: ${typeof t}`,i)},Yo=(t,e,n,r,i)=>{const s=t.split(".");if(s.length<2)throw new M(`Invalid dot notation path '${t}'. Must contain at least one dot.`,i);let o=n;for(let c=0;c<s.length-1;c++){const f=s[c],l=r.entities[o];if(!l)throw new M(`Entity '${o}' does not exist in schema while traversing dot notation path '${t}'.`,i);const p=l.links[f];if(!p){const y=Object.keys(l.links);throw new M(`Link '${f}' does not exist on entity '${o}' in dot notation path '${t}'. Available links: ${y.length>0?y.join(", "):"none"}`,i)}o=p.entityName}const a=s[s.length-1],u=r.entities[o];if(!u)throw new M(`Target entity '${o}' does not exist in schema for dot notation path '${t}'.`,i);if(a==="id"){if(typeof e=="string"&&!Oe(e))throw new M(`Invalid value for id field in entity '${o}'. Expected a UUID, but received: ${e}`,i);je(e,t,new ce("string",!1,!0),n,i);return}const d=u.attrs[a];if(Object.keys(u.links).includes(a)){if(typeof e=="string"&&!Oe(e))throw new M(`Invalid value for link '${a}' in entity '${o}'. Expected a UUID, but received: ${e}`,i);je(e,t,new ce("string",!1,!0),n,i);return}if(!d){const c=Object.keys(u.attrs);throw new M(`Attribute '${a}' does not exist on entity '${o}' in dot notation path '${t}'. Available attributes: ${c.length>0?c.join(", ")+", id":"id"}`,i)}je(e,t,d,n,i)},mr=(t,e,n,r)=>{for(const[i,s]of Object.entries(t)){if(i==="or"||i==="and"){if(Array.isArray(s))for(const d of s)typeof d=="object"&&d!==null&&mr(d,e,n,`${r}.${i}[${d}]`);continue}if(i==="id"){je(s,"id",new ce("string",!1,!0),e,`${r}.id`);continue}if(i.includes(".")){Yo(i,s,e,n,`${r}.${i}`);continue}const o=n.entities[e];if(!o)continue;const a=o.attrs[i],u=o.links[i];if(!a&&!u){const d=Object.keys(o.attrs),c=Object.keys(o.links);throw new M(`Attribute or link '${i}' does not exist on entity '${e}'. Available attributes: ${d.length>0?d.join(", "):"none"}. Available links: ${c.length>0?c.join(", "):"none"}`,`${r}.${i}`)}if(a)je(s,i,a,e,`${r}.${i}`);else if(u){if(typeof s=="string"&&!Oe(s))throw new M(`Invalid value for link '${i}' in entity '${e}'. Expected a UUID, but received: ${s}`,`${r}.${i}`);const d=new ce("string",!1,!0);je(s,i,d,e,`${r}.${i}`)}}},Jo=(t,e,n,r,i=0)=>{for(const o of Object.keys(t))if(!gr.includes(o))throw new M(`Invalid query parameter '${o}' in $ object. Valid parameters are: ${gr.join(", ")}. Found: ${o}`,r);const s=["offset","before","after","first","last"];for(const o of s)if(t[o]!==void 0&&i>0)throw new M(`'${o}' can only be used on top-level namespaces. It cannot be used in nested queries.`,r);if(t.where&&n){if(typeof t.where!="object"||t.where===null)throw new M(`'where' clause must be an object in entity '${e}', but received: ${typeof t.where}`,r?`${r}.where`:void 0);mr(t.where,e,n,r?`${r}.where`:"where")}},wr=(t,e,n,r,i=0)=>{var s;if(!t||typeof t!="object")throw new M(`Query part for entity '${e}' must be an object, but received: ${typeof t}`,r);for(const o of Object.keys(t))if(o!=="$"){if(n&&!(o in n.entities[e].links)){const u=Object.keys(n.entities[e].links);throw new M(`Link '${o}' does not exist on entity '${e}'. Available links: ${u.length>0?u.join(", "):"none"}`,`${r}.${o}`)}const a=t[o];if(typeof a=="object"&&a!==null){const u=(s=n==null?void 0:n.entities[e].links[o])===null||s===void 0?void 0:s.entityName;u&&wr(a,u,n,`${r}.${o}`,i+1)}}else{const a=t[o];if(typeof a!="object"||a===null)throw new M(`Query parameter '$' must be an object in entity '${e}', but received: ${typeof a}`,`${r}.$`);Jo(a,e,n,`${r}.$`,i)}},vr=(t,e)=>{if(typeof t!="object"||t===null)throw new M(`Query must be an object, but received: ${typeof t}${t===null?" (null)":""}`);if(Array.isArray(t))throw new M(`Query must be an object, but received: ${typeof t}`);const n=t;for(const r of Object.keys(n)){if(Array.isArray(t[r]))throw new M(`Query keys must be strings, but found key of type: ${typeof r}`,r);if(typeof r!="string")throw new M(`Query keys must be strings, but found key of type: ${typeof r}`,r);if(r!=="$$ruleParams"){if(e&&!e.entities[r]){const i=Object.keys(e.entities);throw new M(`Entity '${r}' does not exist in schema. Available entities: ${i.length>0?i.join(", "):"none"}`,r)}wr(n[r],r,e,r,0)}}},Sr=t=>typeof t!="string"?!1:st(t)?!0:Oe(t);class Z extends Error{constructor(e){super(e),this.name="TransactionValidationError"}}const Or=t=>t.length>0?t.join(", "):"none",Zo=(t,e)=>new Z(`Entity '${t}' does not exist in schema. Available entities: ${Or(e)}`),Er={string:t=>typeof t=="string",number:t=>typeof t=="number"&&!isNaN(t),boolean:t=>typeof t=="boolean",date:t=>t instanceof Date||typeof t=="string"||typeof t=="number",json:()=>!0},Xo=(t,e)=>{var n,r;return t==null?!0:(r=(n=Er[e.valueType])===null||n===void 0?void 0:n.call(Er,t))!==null&&r!==void 0?r:!1},Ar=(t,e)=>{const n=e.entities[t];if(!n)throw Zo(t,Object.keys(e.entities));return n},Ht=(t,e,n)=>{const r=Ar(t,n);if(typeof e!="object"||e===null)throw new Z(`Arguments for data operation on entity '${t}' must be an object, but received: ${typeof e}`);for(const[i,s]of Object.entries(e)){if(i==="id")continue;const o=r.attrs[i];if(o&&!Xo(s,o))throw new Z(`Invalid value for attribute '${i}' in entity '${t}'. Expected ${o.valueType}, but received: ${typeof s}`)}},kr=(t,e,n)=>{const r=Ar(t,n);if(typeof e!="object"||e===null)throw new Z(`Arguments for link operation on entity '${t}' must be an object, but received: ${typeof e}`);for(const[i,s]of Object.entries(e)){if(!r.links[i]){const a=Object.keys(r.links);throw new Z(`Link '${i}' does not exist on entity '${t}'. Available links: ${Or(a)}`)}if(s!=null){if(Array.isArray(s)){for(const a of s)if(!Sr(a))throw new Z(`Invalid entity ID in link '${i}' for entity '${t}'. Expected a UUID or a lookup, but received: ${a}`)}else if(!Sr(s))throw new Z(`Invalid UUID in link '${i}' for entity '${t}'. Expected a UUID, but received: ${s}`)}}},ea={create:Ht,update:Ht,merge:Ht,link:kr,unlink:kr,delete:()=>{}},ta=(t,e)=>{if(!e)return;const[n,r,i,s]=t;if(!Array.isArray(i)&&!Oe(i))throw new Z(`Invalid id for entity '${r}'. Expected a UUID, but received: ${i}`);if(typeof r!="string")throw new Z(`Entity name must be a string, but received: ${typeof r}`);const o=ea[n];o&&s!==void 0&&o(r,s,e)},na=(t,e)=>{const n=Array.isArray(t)?t:[t];for(const r of n){if(!r||typeof r!="object")throw new Z(`Transaction chunk must be an object, but received: ${typeof r}`);if(!Array.isArray(r.__ops))throw new Z(`Transaction chunk must have __ops array, but received: ${typeof r.__ops}`);for(const i of r.__ops){if(!Array.isArray(i))throw new Z(`Transaction operation must be an array, but received: ${typeof i}`);ta(i,e)}}};var jr=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};let Cr=0;class Pr{constructor(e){this.type="ws",this.id=`${this.type}_${Cr++}`,this.conn=new WebSocket(e),this.conn.onopen=n=>{this.onopen&&this.onopen({target:this})},this.conn.onmessage=n=>{this.onmessage&&this.onmessage({target:this,message:JSON.parse(n.data.toString())})},this.conn.onclose=n=>{this.onclose&&this.onclose({target:this})},this.conn.onerror=n=>{this.onerror&&this.onerror({target:this})}}close(){this.conn.close()}isOpen(){var e;return this.conn.readyState===((e=WebSocket.OPEN)!==null&&e!==void 0?e:1)}isConnecting(){var e;return this.conn.readyState===((e=WebSocket.CONNECTING)!==null&&e!==void 0?e:0)}send(e){return this.conn.send(JSON.stringify(e))}}class ra{constructor(e,n){this.type="sse",this.initParams=null,this.sendQueue=[],this.closeFired=!1,this.sseInitTimeout=void 0,this.id=`${this.type}_${Cr++}`,this.url=n,this.ES=e,this.conn=new e(n),this.sseInitTimeout=setTimeout(()=>{this.initParams||this.handleError()},1e4),this.conn.onmessage=r=>{const i=JSON.parse(r.data);if(Array.isArray(i))for(const s of i)this.handleMessage(s);else this.handleMessage(i)},this.conn.onerror=r=>{this.handleError()}}handleMessage(e){if(e.op==="sse-init"){this.initParams={machineId:e["machine-id"],sessionId:e["session-id"],sseToken:e["sse-token"]},this.onopen&&this.onopen({target:this}),clearTimeout(this.sseInitTimeout);return}this.onmessage&&this.onmessage({target:this,message:e})}handleError(){try{this.onerror&&this.onerror({target:this})}finally{this.handleClose()}}handleClose(){this.conn.close(),this.onclose&&!this.closeFired&&(this.closeFired=!0,this.onclose({target:this}))}postMessages(e){return jr(this,void 0,void 0,function*(){var n,r,i;try{(yield fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({machine_id:(n=this.initParams)===null||n===void 0?void 0:n.machineId,session_id:(r=this.initParams)===null||r===void 0?void 0:r.sessionId,sse_token:(i=this.initParams)===null||i===void 0?void 0:i.sseToken,messages:e})})).ok||this.handleError()}catch{this.handleError()}})}flushQueue(){return jr(this,void 0,void 0,function*(){if(this.sendPromise||!this.sendQueue.length)return;const e=this.sendQueue;this.sendQueue=[];const n=this.postMessages(e);this.sendPromise=n,n.then(()=>{this.sendPromise=null,this.flushQueue()})})}send(e){if(!this.isOpen()||!this.initParams)throw this.isConnecting()?new Error("Failed to execute 'send' on 'EventSource': Still in CONNECTING state."):this.conn.readyState===this.ES.CLOSED?new Error("EventSource is already in CLOSING or CLOSED state."):new Error("EventSource is in invalid state.");this.sendQueue.push(e),this.flushQueue()}isOpen(){return this.conn.readyState===this.ES.OPEN&&this.initParams!==null}isConnecting(){return this.conn.readyState===this.ES.CONNECTING||this.conn.readyState===this.ES.OPEN&&this.initParams===null}close(){this.handleClose()}}var Ir=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})};function ia(t,e){const n=t.values;if(n)for(const r of n.entities||[])r.store.useDateObjects=e,r.store.attrs=n.attrs,r.store=Rn(r.store);return t}function sa(t,e){var n,r;if(!((n=e.values)===null||n===void 0)&&n.entities){const i=[];for(const s of(r=e.values)===null||r===void 0?void 0:r.entities){const o=Mn(s.store);delete o.attrs,i.push(Object.assign(Object.assign({},s),{store:o}))}return Object.assign(Object.assign({},e),{values:Object.assign(Object.assign({},e.values),{entities:i})})}else return e}function oa(t,e,n){var r,i;const s=(r=e==null?void 0:e.state)===null||r===void 0?void 0:r.txId,o=(i=n==null?void 0:n.state)===null||i===void 0?void 0:i.txId;return s&&(!o||s>o)?e:o&&(!s||o>s)?n:e||n}function Yt(t,e){return Xn({store:e,pageInfo:null,aggregate:null},t.query).data[t.table][0]}function Mr(t,e,n){var r;const i=(r=fe(e,t.table,"id"))===null||r===void 0?void 0:r.id;if(!i)return-1;const s=Se(e.eav,[n,i,n]);return s?s[3]:-1}function Rr(t,e){for(const{action:n,triple:r}of e)switch(n){case"added":$n(t,r);break;case"removed":xn(t,r);break}}function aa(t,e){var n,r,i,s;const o={};for(const{action:a,triple:u}of e){const[d,c,f]=u,l=(r=(n=t.attrs[c])===null||n===void 0?void 0:n["forward-identity"])===null||r===void 0?void 0:r[2];if(!l)continue;const p=(i=o[d])!==null&&i!==void 0?i:{};o[d]=p;const y=(s=p[l])!==null&&s!==void 0?s:{};switch(p[l]=y,a){case"added":y.newValue=f;break;case"removed":y.oldValue===void 0&&(y.oldValue=f);break}}for(const a of Object.keys(o)){const{oldValue:u,newValue:d}=o[a];u===d&&delete o[a]}return o}function ut(t,e){return{[t.table]:e.map(n=>n.entity)}}function ua(t,e){var n;if(t.orderFieldType)return t.orderFieldType;const r=t.orderField==="serverCreatedAt"?"number":(n=fe(e([]),t.table,t.orderField))===null||n===void 0?void 0:n["checked-data-type"];return t.orderFieldType=r,r}function ca(t,e,n){const r=e;if(t.orderField==="serverCreatedAt"){n.sort(t.orderDirection==="asc"?function(o,a){return Ne(o.entity.id,o.serverCreatedAt,a.entity.id,a.serverCreatedAt,r)}:function(o,a){return Ne(a.entity.id,a.serverCreatedAt,o.entity.id,o.serverCreatedAt,r)});return}const i=t.orderField;n.sort(t.orderDirection==="asc"?function(o,a){return Ne(o.entity.id,o.entity[i],a.entity.id,a.entity[i],r)}:function(o,a){return Ne(a.entity.id,a.entity[i],o.entity.id,o.entity[i],r)})}var _e;(function(t){t.InitialSyncBatch="InitialSyncBatch",t.InitialSyncComplete="InitialSyncComplete",t.LoadFromStorage="LoadFromStorage",t.SyncTransaction="SyncTransaction",t.Error="Error"})(_e||(_e={}));class da{constructor(e,n,r,i,s){this.callbacks={},this.idToHash={},this.trySend=e,this.config=r,this.log=i,this.createStore=s,this.subs=new Gt({persister:n,merge:oa,serialize:sa,parse:(o,a)=>ia(a,this.config.useDateObjects),objectSize:o=>{var a;return((a=o.values)===null||a===void 0?void 0:a.entities.length)||0},logger:i,gc:{maxAgeMs:1e3*60*60*24*7*52,maxEntries:1e3,maxSize:1e6}})}beforeUnload(){this.subs.flush()}subscribe(e,n){const r=N(e);return this.callbacks[r]=this.callbacks[r]||[],this.callbacks[r].push(n),this.initSubscription(e,r,n),i=>{this.unsubscribe(r,n,i==null?void 0:i.keepSubscription)}}unsubscribe(e,n,r){const i=(this.callbacks[e]||[]).filter(s=>s!==n);if(this.callbacks[e]=i,!i.length){delete this.callbacks[e];const s=this.subs.currentValue[e];s!=null&&s.state&&this.clearSubscriptionData(s.state.subscriptionId,!!r),r||this.subs.updateInPlace(o=>{delete o[e]})}}sendStart(e){this.trySend(F(),{op:"start-sync",q:e})}sendResync(e,n,r){this.idToHash[n.subscriptionId]=e.hash,this.trySend(n.subscriptionId,{op:"resync-table","subscription-id":n.subscriptionId,"tx-id":r,token:n.token})}sendRemove(e,n){this.trySend(F(),{op:"remove-sync","subscription-id":e.subscriptionId,"keep-subscription":n})}initSubscription(e,n,r){return Ir(this,void 0,void 0,function*(){var i,s,o,a;yield this.subs.waitForKeyToLoad(n);const u=this.subs.currentValue[n];if(u&&u.state&&u.state.txId){this.sendResync(u,u.state,u.state.txId),!((i=u.values)===null||i===void 0)&&i.entities&&r&&r({type:_e.LoadFromStorage,data:ut(u,(s=u.values)===null||s===void 0?void 0:s.entities)});return}const d=Object.keys(e)[0],c=((a=(o=e[d])===null||o===void 0?void 0:o.$)===null||a===void 0?void 0:a.order)||{serverCreatedAt:"asc"},[f,l]=Object.entries(c)[0];this.subs.updateInPlace(p=>{p[n]={query:e,hash:n,table:d,orderDirection:l,orderField:f,createdAt:Date.now(),updatedAt:Date.now()}}),this.sendStart(e)})}flushPending(){return Ir(this,void 0,void 0,function*(){for(const e of Object.keys(this.callbacks)){yield this.subs.waitForKeyToLoad(e);const n=this.subs.currentValue[e];n?yield this.initSubscription(n.query,n.hash):this.log.error("Missing sub for hash in flushPending",e)}})}onStartSyncOk(e){const n=e["subscription-id"],r=e.q,i=N(r);this.idToHash[n]=i,this.subs.updateInPlace(s=>{const o=s[i];if(!o)return this.log.error("Missing sub for hash",i,"subscription-id",n,"query",r),s;o.state={subscriptionId:n,token:e.token}})}notifyCbs(e,n){for(const r of this.callbacks[e]||[])r(n)}onSyncLoadBatch(e){var n;const r=e["subscription-id"],i=e["join-rows"],s=this.idToHash[r];if(!s){this.log.error("Missing hash for subscription",e);return}const o=[],a=this.subs.currentValue[s];if(!a){this.log.error("Missing sub for hash",s,e);return}const u=(n=a.values)!==null&&n!==void 0?n:{entities:[],attrs:this.createStore([]).attrs};a.values=u;const d=u.entities;for(const c of i){const f=this.createStore(c);u.attrs=f.attrs;const l=Yt(a,f);d.push({store:f,entity:l,serverCreatedAt:Mr(a,f,l.id)}),o.push(l)}this.subs.updateInPlace(c=>{c[s]=a,c[s].updatedAt=Date.now()}),a.values&&this.notifyCbs(s,{type:_e.InitialSyncBatch,data:ut(a,a.values.entities),batch:o})}onSyncInitFinish(e){var n;const r=e["subscription-id"],i=this.idToHash[r];if(!i){this.log.error("Missing hash for subscription",e);return}this.subs.updateInPlace(o=>{const a=o[i];if(!a){this.log.error("Missing sub for hash",i,e);return}const u=a.state;if(!u)return this.log.error("Sub never set init, missing result",a,e),o;u.txId=e["tx-id"],a.updatedAt=Date.now()});const s=this.subs.currentValue[i];s&&this.notifyCbs(i,{type:_e.InitialSyncComplete,data:ut(s,((n=s.values)===null||n===void 0?void 0:n.entities)||[])})}onSyncUpdateTriples(e){var n,r,i;const s=e["subscription-id"],o=this.idToHash[s];if(!o){this.log.error("Missing hash for subscription",e);return}const a=this.subs.currentValue[o];if(!a){this.log.error("Missing sub for hash",o,e);return}const u=a.state;if(!u){this.log.error("Missing state for sub",a,e);return}for(const d of e.txes){if(u.txId&&u.txId>=d["tx-id"])continue;u.txId=d["tx-id"];const c=[],f={};for(const T of d.changes){const v=(n=f[T.triple[0]])!==null&&n!==void 0?n:[];f[T.triple[0]]=v,v.push(T)}const l=(r=a.values)!==null&&r!==void 0?r:{entities:[],attrs:this.createStore([]).attrs},p=l.entities;a.values=l;const y=[];e:for(const[T,v]of Object.entries(f))for(let C=0;C<p.length;C++){const S=p[C];if(Vi(S.store,T)){Rr(S.store,v);const R=Yt(a,S.store),x=aa(S.store,v)[T];R?(y.push({oldEntity:S.entity,newEntity:R,changedFields:x||{}}),S.entity=R):c.push(C),delete f[T];continue e}}const b=[];for(const[T,v]of Object.entries(f)){const C=this.createStore([]);l.attrs=C.attrs,Rr(C,v);const S=Yt(a,C);if(!S){this.log.error("No entity found after applying change",{sub:a,changes:v,store:C});continue}p.push({store:C,entity:S,serverCreatedAt:Mr(a,C,S.id)}),b.push(S)}const g=[];for(const T of c.sort().reverse())g.push(p[T].entity),p.splice(T,1);const m=ua(a,this.createStore);ca(a,m,p),this.notifyCbs(o,{type:_e.SyncTransaction,data:ut(a,(i=a.values)===null||i===void 0?void 0:i.entities),added:b,removed:g,updated:y})}this.subs.updateInPlace(d=>{d[o]=a,d[o].updatedAt=Date.now()})}clearSubscriptionData(e,n){const r=this.idToHash[e];if(r){delete this.idToHash[e];const i=this.subs.currentValue[r];if(i.state&&this.sendRemove(i.state,n),n?this.subs.unloadKey(r):this.subs.updateInPlace(s=>{delete s[r]}),i)return i}}onStartSyncError(e){const n=N(e["original-event"].q),r={message:e.message||"Uh-oh, something went wrong. Ping Joe & Stopa.",status:e.status,type:e.type,hint:e.hint},i=Object.keys(e["original-event"].q)[0];this.notifyCbs(n,{type:_e.Error,data:{[i]:[]},error:r})}onResyncError(e){const n=e["original-event"]["subscription-id"],r=this.clearSubscriptionData(n,!1);r&&this.initSubscription(r.query,r.hash)}}var U=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{d(r.next(c))}catch(f){o(f)}}function u(c){try{d(r.throw(c))}catch(f){o(f)}}function d(c){c.done?s(c.value):i(c.value).then(a,u)}d((r=r.apply(t,e||[])).next())})},fa=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n};const de={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},la=3e4,ha=3e4,pa=200,ya={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},Jt="_instant_oauth_redirect",Ve="currentUser";function ba({transportType:t,appId:e,apiURI:n,wsURI:r,EventSourceImpl:i}){if(!i)return new Pr(`${r}?app_id=${e}`);switch(t){case"ws":return new Pr(`${r}?app_id=${e}`);case"sse":return new ra(i,`${n}/runtime/sse?app_id=${e}`);default:throw new Error("Unknown transport type "+t)}}function _a(){return typeof window<"u"||typeof chrome<"u"}const xr={"set-presence":!0,"set-presence-ok":!0,"refresh-presence":!0,"patch-presence":!0};function ga(t,e){var n;const r=typeof t=="string"?JSON.parse(t):t;if(!((n=r==null?void 0:r.result)===null||n===void 0)&&n.store){const i=r.result.store;r.result.store=Rn(Object.assign(Object.assign({},i),{useDateObjects:e}))}return r}function Ta(t,e){var n;const r=Object.assign({},e);return!((n=e.result)===null||n===void 0)&&n.store&&(r.result=Object.assign(Object.assign({},e.result),{store:Mn(e.result.store)})),r}function ma(t,e){switch(t){case"pendingMutations":return new Map(typeof e=="string"?JSON.parse(e):e);default:return e}}function wa(t,e){switch(t){case"pendingMutations":return[...e.entries()];default:return e}}function va(t,e,n){const r=e==null?void 0:e.result,i=n==null?void 0:n.result;return r&&!i&&n&&(n.result=r),n||e}function Dr(t){return[...t].sort((e,n)=>{const[r,i]=e,[s,o]=n,a=i.order||0,u=o.order||0;return a==u?r<s?-1:r>s?1:0:a-u})}class Sa{constructor(e,n=ar,r=ur,i,s){var o,a,u;if(this._isOnline=!0,this._isShutdown=!1,this.status=de.CONNECTING,this.queryCbs={},this.queryOnceDfds={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.connectionStatusCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._transportType="ws",this._wsOk=null,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._rooms={},this._roomsPendingLeave={},this._presence={},this._broadcastQueue=[],this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._beforeUnloadCbs=[],this._dataForQueryCache={},this._inFlightMutationEventIds=new Set,this._onMergeKv=(d,c,f)=>{var l,p;switch(d){case"pendingMutations":{const y=(l=c==null?void 0:c.entries())!==null&&l!==void 0?l:[],b=(p=f==null?void 0:f.entries())!==null&&p!==void 0?p:[],g=new Map([...y,...b]);return(c?this._rewriteMutationsSorted(this.attrs,c):[]).forEach(([T,v])=>{var C;!(!((C=f==null?void 0:f.pendingMutations)===null||C===void 0)&&C.has(T))&&!v["tx-id"]&&this._sendMutation(T,v)}),g}default:return f||c}},this.getPreviousResult=d=>{var c;const f=N(d);return(c=this.dataForQuery(f))===null||c===void 0?void 0:c.data},this.notifyOne=d=>{var c,f;const l=(c=this.queryCbs[d])!==null&&c!==void 0?c:[],p=(f=this._dataForQueryCache[d])===null||f===void 0?void 0:f.data,y=this.dataForQuery(d);y!=null&&y.data&&(this._dataForQueryCache[d]=y,!Xe(y.data,p)&&l.forEach(b=>b.cb(y.data)))},this.notifyOneQueryOnce=d=>{var c,f;const l=(c=this.queryOnceDfds[d])!==null&&c!==void 0?c:[],p=(f=this.dataForQuery(d))===null||f===void 0?void 0:f.data;l.forEach(y=>{this._completeQueryOnce(y.q,d,y.dfd),y.dfd.resolve(p)})},this.notifyQueryError=(d,c)=>{(this.queryCbs[d]||[]).forEach(l=>l.cb({error:c}))},this.pushTx=d=>{this.config.disableValidation||na(d,this.config.schema);try{const c=Oo({attrs:this.optimisticAttrs(),schema:this.config.schema,stores:Object.values(this.querySubs.currentValue).map(f=>{var l;return(l=f==null?void 0:f.result)===null||l===void 0?void 0:l.store}),useDateObjects:this.config.useDateObjects},d);return this.pushOps(c)}catch(c){return this.pushOps([],c)}},this.pushOps=(d,c)=>{const f=F(),l=[...this._pendingMutations().values()],p=Math.max(0,...l.map(g=>g.order||0))+1,y={op:"transact","tx-steps":d,created:Date.now(),error:c,order:p};this._updatePendingMutations(g=>{g.set(f,y)});const b=new hr;return this.mutationDeferredStore.set(f,b),this._sendMutation(f,y),this.notifyAll(),b.promise},this._transportOnOpen=d=>{const c=d.target;if(this._transport!==c){this._log.info("[socket][open]",c.id,"skip; this is no longer the current transport");return}this._log.info("[socket][open]",this._transport.id),this._setStatus(de.OPENED),this.getCurrentUser().then(f=>{var l;this._trySend(F(),{op:"init","app-id":this.config.appId,"refresh-token":(l=f.user)===null||l===void 0?void 0:l.refresh_token,versions:this.versions,"__admin-token":this.config.__adminToken})}).catch(f=>{this._log.error("[socket][error]",c.id,f)})},this._transportOnMessage=d=>{const c=d.target,f=d.message;if(this._transport!==c){this._log.info("[socket][message]",c.id,f,"skip; this is no longer the current transport");return}if(!this._wsOk&&c.type==="ws"&&(this._wsOk=!0),this._transportType="ws",Array.isArray(d.message))for(const l of d.message)this._handleReceive(c.id,l);else this._handleReceive(c.id,d.message)},this._transportOnError=d=>{const c=d.target;if(this._transport!==c){this._log.info("[socket][error]",c.id,"skip; this is no longer the current transport");return}this._log.error("[socket][error]",c.id,d)},this._scheduleReconnect=()=>{!this._wsOk&&this._transportType!=="sse"&&(this._transportType="sse",this._reconnectTimeoutMs=0),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){this._log.info("[socket][close]",this._transport.id,"we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this._transportOnClose=d=>{const c=d.target;if(this._transport!==c){this._log.info("[socket][close]",c.id,"skip; this is no longer the current transport");return}this._setStatus(de.CLOSED);for(const f of Object.values(this._rooms))f.isConnected=!1;if(this._isShutdown){this._log.info("[socket][close]",c.id,"Reactor has been shut down and will not reconnect");return}this._log.info("[socket][close]",c.id,"schedule reconnect, ms =",this._reconnectTimeoutMs),this._scheduleReconnect()},this._EventSource=s,this.config=Object.assign(Object.assign({},ya),e),this.queryCacheLimit=(o=this.config.queryCacheLimit)!==null&&o!==void 0?o:10,this._pendingTxCleanupTimeout=(a=this.config.pendingTxCleanupTimeout)!==null&&a!==void 0?a:ha,this._pendingMutationCleanupThreshold=(u=this.config.pendingMutationCleanupThreshold)!==null&&u!==void 0?u:pa,this._log=Go(e.verbose||Qt||dr,()=>this._reactorStats()),this.versions=Object.assign(Object.assign({},i||{}),{"@instantdb/core":_r}),this.config.schema&&(this._linkIndex=br(this.config.schema)),!!_a()){if(!e.appId)throw new Error("Instant must be initialized with an appId.");if(!Oe(e.appId))throw new Error(`Instant must be initialized with a valid appId. \`${e.appId}\` is not a valid uuid.`);typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",d=>U(this,void 0,void 0,function*(){var c;try{if(((c=d.data)===null||c===void 0?void 0:c.type)==="auth"){const f=yield this.getCurrentUser();this.updateUser(f.user)}}catch(f){this._log.error("[error] handle broadcast channel",f)}}))),this._initStorage(n),this._syncTable=new da(this._trySendAuthed.bind(this),new n(this.config.appId,"syncSubs"),{useDateObjects:this.config.useDateObjects},this._log,d=>tt(this.attrs,d,this.config.enableCardinalityInference,this._linkIndex,this.config.useDateObjects)),this._oauthCallbackResponse=this._oauthLoginInit(),this.getCurrentUser(),r.getIsOnline().then(d=>{this._isOnline=d,this._startSocket(),r.listen(c=>{c!==this._isOnline&&(this._log.info("[network] online =",c),this._isOnline=c,this._isOnline?this._startSocket():(this._log.info("Changing status from",this.status,"to",de.CLOSED),this._setStatus(de.CLOSED)))})}),typeof addEventListener<"u"&&(this._beforeUnload=this._beforeUnload.bind(this),addEventListener("beforeunload",this._beforeUnload))}}updateSchema(e){this.config=Object.assign(Object.assign({},this.config),{schema:e,cardinalityInference:!!e}),this._linkIndex=e?br(this.config.schema):null}_reactorStats(){return{inFlightMutationCount:this._inFlightMutationEventIds.size,storedMutationCount:this._pendingMutations().size,transportType:this._transportType}}_onQuerySubLoaded(e){this.kv.waitForKeyToLoad("pendingMutations").then(()=>this.notifyOne(e))}_initStorage(e){this.querySubs=new Gt({persister:new e(this.config.appId,"querySubs"),merge:va,serialize:Ta,parse:(n,r)=>ga(r,this.config.useDateObjects),objectSize:n=>{var r,i,s,o;return(o=(s=(i=(r=n.result)===null||r===void 0?void 0:r.store)===null||i===void 0?void 0:i.triples)===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:0},logger:this._log,preloadEntryCount:10,gc:{maxAgeMs:1e3*60*60*24*7*52,maxEntries:1e3,maxSize:1e6}}),this.querySubs.onKeyLoaded=n=>this._onQuerySubLoaded(n),this.kv=new Gt({persister:new e(this.config.appId,"kv"),merge:this._onMergeKv,serialize:wa,parse:ma,objectSize:()=>0,logger:this._log,saveThrottleMs:100,idleCallbackMaxWaitMs:100,gc:null}),this.kv.onKeyLoaded=n=>{n==="pendingMutations"&&this.notifyAll()},this.kv.waitForKeyToLoad("pendingMutations"),this.kv.waitForKeyToLoad(Ve),this._beforeUnloadCbs.push(()=>{this.kv.flush(),this.querySubs.flush()})}_beforeUnload(){for(const e of this._beforeUnloadCbs)e();this._syncTable.beforeUnload()}_finishTransaction(e,n,r){const i=this.mutationDeferredStore.get(n);this.mutationDeferredStore.delete(n);const s=e!=="error"&&e!=="timeout";if(!i&&!s&&console.error("Mutation failed",Object.assign({status:e,eventId:n},r)),!!i)if(s)i.resolve({status:e,eventId:n});else if(r!=null&&r.type){const{status:o}=r,a=fa(r,["status"]);i.reject(new at({body:a,status:o??0}))}else i.reject(new Ae((r==null?void 0:r.message)||"Unknown error",r==null?void 0:r.hint))}_setStatus(e,n){this.status=e,this._errorMessage=n,this.notifyConnectionStatusSubs(e)}_flushEnqueuedRoomData(e){var n,r;const i=(r=(n=this._presence[e])===null||n===void 0?void 0:n.result)===null||r===void 0?void 0:r.user,s=this._broadcastQueue[e];if(this._broadcastQueue[e]=[],i&&this._trySetPresence(e,i),s)for(const o of s){const{topic:a,roomType:u,data:d}=o;this._tryBroadcast(e,u,a,d)}}_handleReceive(e,n){var r,i,s,o,a,u;const d=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(xr[n.op]||this._log.info("[receive]",e,n.op,n),n.op){case"init-ok":{this._setStatus(de.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(n.attrs),this._flushPendingMessages(),this._sessionId=n["session-id"];for(const l of Object.keys(this._rooms)){const p=(i=(r=this._presence[l])===null||r===void 0?void 0:r.result)===null||i===void 0?void 0:i.user;this._tryJoinRoom(l,p)}break}case"add-query-exists":{this.notifyOneQueryOnce(N(n.q));break}case"add-query-ok":{const{q:l,result:p}=n,y=N(l);if(!this._hasQueryListeners()&&!this.querySubs.currentValue[y])break;const b=(o=(s=p==null?void 0:p[0])===null||s===void 0?void 0:s.data)===null||o===void 0?void 0:o["page-info"],g=(u=(a=p==null?void 0:p[0])===null||a===void 0?void 0:a.data)===null||u===void 0?void 0:u.aggregate,m=yr(p),T=tt(this.attrs,m,d,this._linkIndex,this.config.useDateObjects);this.querySubs.updateInPlace(v=>{if(!v[y]){this._log.info("Missing value in querySubs",{hash:y,q:l});return}v[y].result={store:T,pageInfo:b,aggregate:g,processedTxId:n["processed-tx-id"]}}),this._cleanupPendingMutationsQueries(),this.notifyOne(y),this.notifyOneQueryOnce(y),this._cleanupPendingMutationsTimeout();break}case"start-sync-ok":{this._syncTable.onStartSyncOk(n);break}case"sync-load-batch":{this._syncTable.onSyncLoadBatch(n);break}case"sync-init-finish":{this._syncTable.onSyncInitFinish(n);break}case"sync-update-triples":{this._syncTable.onSyncUpdateTriples(n);break}case"refresh-ok":{const{computations:l,attrs:p}=n,y=n["processed-tx-id"];p&&this._setAttrs(p),this._cleanupPendingMutationsTimeout();const b=this._rewriteMutations(this.attrs,this._pendingMutations(),y);b!==this._pendingMutations()&&this.kv.updateInPlace(T=>{T.pendingMutations=b});const g=Dr(b.entries()),m=l.map(T=>{var v,C,S,R;const x=T["instaql-query"],W=T["instaql-result"],We=N(x),dt=yr(W),en=tt(this.attrs,dt,d,this._linkIndex,this.config.useDateObjects),tn=this._applyOptimisticUpdates(en,g,y),ft=(C=(v=W==null?void 0:W[0])===null||v===void 0?void 0:v.data)===null||C===void 0?void 0:C["page-info"],se=(R=(S=W==null?void 0:W[0])===null||S===void 0?void 0:S.data)===null||R===void 0?void 0:R.aggregate;return{q:x,hash:We,store:tn,pageInfo:ft,aggregate:se}});m.forEach(({hash:T,q:v,store:C,pageInfo:S,aggregate:R})=>{this.querySubs.updateInPlace(x=>{if(!x[T]){this._log.error("Missing value in querySubs",{hash:T,q:v});return}x[T].result={store:C,pageInfo:S,aggregate:R,processedTxId:y}})}),this._cleanupPendingMutationsQueries(),m.forEach(({hash:T})=>{this.notifyOne(T)});break}case"transact-ok":{const{"client-event-id":l,"tx-id":p}=n;this._inFlightMutationEventIds.delete(l);const b=this._rewriteMutations(this.attrs,this._pendingMutations()).get(l);if(!b)break;this._updatePendingMutations(m=>{m.set(l,Object.assign(Object.assign({},m.get(l)),{"tx-id":p,confirmed:Date.now()}))});const g=b["tx-steps"].filter(([m,...T])=>m==="add-attr").map(([m,T])=>T).concat(Object.values(this.attrs));this._setAttrs(g),this._finishTransaction("synced",l),this._cleanupPendingMutationsTimeout();break}case"patch-presence":{const l=n["room-id"];this._trySetRoomConnected(l,!0),this._patchPresencePeers(l,n.edits),this._notifyPresenceSubs(l);break}case"refresh-presence":{const l=n["room-id"];this._trySetRoomConnected(l,!0),this._setPresencePeers(l,n.data),this._notifyPresenceSubs(l);break}case"server-broadcast":{const l=n["room-id"],p=n.topic;this._trySetRoomConnected(l,!0),this._notifyBroadcastSubs(l,p,n);break}case"join-room-ok":{const l=n["room-id"];if(!this._rooms[l]){this._roomsPendingLeave[l]&&(this._tryLeaveRoom(l),delete this._roomsPendingLeave[l]);break}this._trySetRoomConnected(l,!0),this._flushEnqueuedRoomData(l);break}case"leave-room-ok":{const l=n["room-id"];this._trySetRoomConnected(l,!1);break}case"join-room-error":const c=n["room-id"],f=this._rooms[c];f&&(f.error=n.error),this._notifyPresenceSubs(c);break;case"error":this._handleReceiveError(n);break;default:this._log.info("Uknown op",n.op,n);break}}_pendingMutations(){var e;return(e=this.kv.currentValue.pendingMutations)!==null&&e!==void 0?e:new Map}_updatePendingMutations(e){this.kv.updateInPlace(n=>{var r;const i=(r=n.pendingMutations)!==null&&r!==void 0?r:new Map;n.pendingMutations=i,e(i)})}_handleMutationError(e,n,r){const i=this._pendingMutations().get(n);if(i&&(e!=="timeout"||!i["tx-id"])){this._updatePendingMutations(o=>(o.delete(n),o)),this._inFlightMutationEventIds.delete(n);const s={message:r.message,hint:r.hint};this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(s),this._finishTransaction(e,n,r)}}_handleReceiveError(e){var n,r,i,s,o,a,u;console.log("error",e);const d=e["client-event-id"];this._inFlightMutationEventIds.delete(d);const c=this._pendingMutations().get(d),f={message:e.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};if(e.hint&&(f.hint=e.hint),c){this._handleMutationError("error",d,e);return}if(!((n=e["original-event"])===null||n===void 0)&&n.hasOwnProperty("q")&&((r=e["original-event"])===null||r===void 0?void 0:r.op)==="add-query"){const y=(i=e["original-event"])===null||i===void 0?void 0:i.q,b=N(y);this.notifyQueryError(N(y),f),this.notifyQueryOnceError(y,b,d,f);return}if(((s=e["original-event"])===null||s===void 0?void 0:s.op)==="init"){if(e.type==="record-not-found"&&((o=e.hint)===null||o===void 0?void 0:o["record-type"])==="app-user"){this.changeCurrentUser(null);return}this._setStatus(de.ERRORED,f),this.notifyAll();return}if(((a=e["original-event"])===null||a===void 0?void 0:a.op)==="resync-table"){this._syncTable.onResyncError(e);return}if(((u=e["original-event"])===null||u===void 0?void 0:u.op)==="start-sync"){this._syncTable.onStartSyncError(e);return}const p=Object.assign({},e);delete p.message,delete p.hint,console.error(e.message,p),e.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,e.hint)}notifyQueryOnceError(e,n,r,i){var s;const o=(s=this.queryOnceDfds[n])===null||s===void 0?void 0:s.find(a=>a.eventId===r);o&&(o.dfd.reject(i),this._completeQueryOnce(e,n,o.dfd))}_setAttrs(e){this.attrs=e.reduce((n,r)=>(n[r.id]=r,n),{}),this.notifyAttrsSubs()}_startQuerySub(e,n){const r=F();return this.querySubs.updateInPlace(i=>{i[n]=i[n]||{q:e,result:null,eventId:r},i[n].lastAccessed=Date.now()}),this._trySendAuthed(r,{op:"add-query",q:e}),r}subscribeTable(e,n){return this._syncTable.subscribe(e,n)}subscribeQuery(e,n,r){var i;this.config.disableValidation||vr(e,this.config.schema),r&&"ruleParams"in r&&(e=Object.assign({$$ruleParams:r.ruleParams},e));const s=N(e),o=this.getPreviousResult(e);return o&&n(o),this.queryCbs[s]=(i=this.queryCbs[s])!==null&&i!==void 0?i:[],this.queryCbs[s].push({q:e,cb:n}),this._startQuerySub(e,s),()=>{this._unsubQuery(e,s,n)}}queryOnce(e,n){var r;this.config.disableValidation||vr(e,this.config.schema),n&&"ruleParams"in n&&(e=Object.assign({$$ruleParams:n.ruleParams},e));const i=new hr;if(!this._isOnline)return i.reject(new Error("We can't run `queryOnce`, because the device is offline.")),i.promise;if(!this.querySubs)return i.reject(new Error("We can't run `queryOnce` on the backend. Use adminAPI.query instead: https://www.instantdb.com/docs/backend#query")),i.promise;const s=N(e),o=this._startQuerySub(e,s);return this.queryOnceDfds[s]=(r=this.queryOnceDfds[s])!==null&&r!==void 0?r:[],this.queryOnceDfds[s].push({q:e,dfd:i,eventId:o}),setTimeout(()=>i.reject(new Error("Query timed out")),la),i.promise}_completeQueryOnce(e,n,r){this.queryOnceDfds[n]&&(this.queryOnceDfds[n]=this.queryOnceDfds[n].filter(i=>i.dfd!==r),this._cleanupQuery(e,n))}_unsubQuery(e,n,r){this.queryCbs[n]&&(this.queryCbs[n]=this.queryCbs[n].filter(i=>i.cb!==r),this._cleanupQuery(e,n))}_hasQueryListeners(e){var n,r;return!!(!((n=this.queryCbs[e])===null||n===void 0)&&n.length||!((r=this.queryOnceDfds[e])===null||r===void 0)&&r.length)}_cleanupQuery(e,n){this._hasQueryListeners(n)||(delete this.queryCbs[n],delete this.queryOnceDfds[n],delete this._dataForQueryCache[n],this.querySubs.unloadKey(n),this._trySendAuthed(F(),{op:"remove-query",q:e}))}_rewriteMutations(e,n,r){if(!e)return n;if(!n)return new Map;const i=c=>{const[f,l,p]=c["forward-identity"];return z(e,l,p)},s=c=>{const[f,l,p]=c["forward-identity"];return be(e,l,p)},o={attrIdMap:{},refSwapAttrIds:new Set};let a=!1;const u=(c,f)=>{const l=[];for(const p of c){const[y]=p;if(y==="add-attr"){const[g,m]=p,T=i(m);if(T&&m.id!==T.id){o.attrIdMap[m.id]=T.id,a=!0;continue}if(m["value-type"]==="ref"){const v=s(m);if(v){o.attrIdMap[m.id]=v.id,o.refSwapAttrIds.add(m.id),a=!0;continue}}}if(r&&f&&r>=f&&y==="add-attr"||y==="update-attr"||y==="delete-attr"){a=!0;continue}const b=a?Xs(o,p):p;l.push(b)}return a?l:c},d=new Map;for(const[c,f]of n.entries())d.set(c,Object.assign(Object.assign({},f),{"tx-steps":u(f["tx-steps"],f["tx-id"])}));return a?d:n}_rewriteMutationsSorted(e,n){return Dr(this._rewriteMutations(e,n).entries())}optimisticAttrs(){var e;const n=[...this._pendingMutations().values()].flatMap(a=>a["tx-steps"]),r=new Set(n.filter(([a,u])=>a==="delete-attr").map(([a,u])=>u)),i=[];for(const[a,u]of n)if(a==="add-attr")i.push(u);else if(a==="update-attr"&&u.id&&(!((e=this.attrs)===null||e===void 0)&&e[u.id])){const d=Object.assign(Object.assign({},this.attrs[u.id]),u);i.push(d)}const s=[...Object.values(this.attrs||{}),...i].filter(a=>!r.has(a.id));return Object.fromEntries(s.map(a=>[a.id,a]))}dataForQuery(e){const n=this._errorMessage;if(n)return{error:n};if(!this.querySubs||!this.kv.currentValue.pendingMutations)return;const r=this.querySubs.version(),i=this.querySubs.currentValue,s=this.kv.version(),o=this._pendingMutations(),{q:a,result:u}=i[e]||{};if(!u)return;const d=this._dataForQueryCache[e];if(d&&r===d.querySubVersion&&s===d.pendingMutationsVersion)return d;const{store:c,pageInfo:f,aggregate:l,processedTxId:p}=u,y=this._rewriteMutationsSorted(c.attrs,o),b=this._applyOptimisticUpdates(c,y,p);return{data:Xn({store:b,pageInfo:f,aggregate:l},a),querySubVersion:r,pendingMutationsVersion:s}}_applyOptimisticUpdates(e,n,r){for(const[i,s]of n)(!s["tx-id"]||r&&s["tx-id"]>r)&&(e=ts(e,s["tx-steps"]));return e}notifyAll(){Object.keys(this.queryCbs).forEach(e=>{this.querySubs.waitForKeyToLoad(e).then(()=>this.notifyOne(e)).catch(()=>this.notifyOne(e))})}loadedNotifyAll(){this.kv.waitForKeyToLoad("pendingMutations").then(()=>this.notifyAll()).catch(()=>this.notifyAll())}shutdown(){var e;this._log.info("[shutdown]",this.config.appId),this._isShutdown=!0,(e=this._transport)===null||e===void 0||e.close()}_sendMutation(e,n){if(n.error){this._handleMutationError("error",e,{message:n.error.message});return}if(this.status!==de.AUTHENTICATED){this._finishTransaction("enqueued",e);return}const r=Math.max(6e3,Math.min(this._inFlightMutationEventIds.size+1,this._pendingMutations().size+1)*6e3);this._isOnline?(this._trySend(e,n),setTimeout(()=>{this._isOnline&&this._handleMutationError("timeout",e,{message:"transaction timed out"})},r)):this._finishTransaction("enqueued",e)}_flushPendingMessages(){Object.keys(this.queryCbs).map(i=>this.querySubs.currentValue[i]).filter(i=>i).forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),Object.values(this.queryOnceDfds).flat().forEach(({eventId:i,q:s})=>{this._trySendAuthed(i,{op:"add-query",q:s})}),this._rewriteMutationsSorted(this.attrs,this._pendingMutations()).forEach(([i,s])=>{s["tx-id"]||this._sendMutation(i,s)}),this._syncTable.flushPending()}_cleanupPendingMutationsQueries(){let e=Number.MAX_SAFE_INTEGER;for(const{result:n}of Object.values(this.querySubs.currentValue))n!=null&&n.processedTxId&&(e=Math.min(e,n==null?void 0:n.processedTxId));this._updatePendingMutations(n=>{for(const[r,i]of Array.from(n.entries()))i["tx-id"]&&i["tx-id"]<=e&&n.delete(r)})}_cleanupPendingMutationsTimeout(){if(this._pendingMutations().size<this._pendingMutationCleanupThreshold)return;const e=Date.now();this._updatePendingMutations(n=>{for(const[r,i]of Array.from(n.entries()))i.confirmed&&i.confirmed+this._pendingTxCleanupTimeout<e&&n.delete(r)})}_trySendAuthed(...e){this.status===de.AUTHENTICATED&&this._trySend(...e)}_trySend(e,n,r){if(this._transport.isOpen()){switch(xr[n.op]||this._log.info("[send]",this._transport.id,n.op,n),n.op){case"transact":{this._inFlightMutationEventIds.add(e);break}case"init":this._inFlightMutationEventIds.clear()}this._transport.send(Object.assign({"client-event-id":e},n))}}_startSocket(){if(this._wsOk=null,this._isShutdown){this._log.info("[socket][start]",this.config.appId,"Reactor has been shut down and will not start a new socket");return}if(this._transport&&this._transport.isConnecting()){this._log.info("[socket][start]",this._transport.id,"maintained as current transport, we were still in a connecting state");return}const e=this._transport;this._transport=ba({transportType:this._transportType,appId:this.config.appId,apiURI:this.config.apiURI,wsURI:this.config.websocketURI,EventSourceImpl:this._EventSource}),this._transport.onopen=this._transportOnOpen,this._transport.onmessage=this._transportOnMessage,this._transport.onclose=this._transportOnClose,this._transport.onerror=this._transportOnError,this._log.info("[socket][start]",this._transport.id),e!=null&&e.isOpen()&&(this._log.info("[socket][start]",this._transport.id,"close previous transport id = ",e.id),e.close())}getLocalId(e){return U(this,void 0,void 0,function*(){const n=`localToken_${e}`;if(this.kv.currentValue[n])return this.kv.currentValue[n];const r=yield this.kv.waitForKeyToLoad(n);if(r)return r;const i=F();return this.kv.updateInPlace(s=>{s[n]||(s[n]=i)}),yield this.kv.waitForKeyToLoad(n)})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const e=new URL(window.location.href);if(e.searchParams.get(Jt)){const n=e.toString();e.searchParams.delete(Jt),e.searchParams.delete("code"),e.searchParams.delete("error");const r=e.pathname+(e.searchParams.size?"?"+e.searchParams:"")+e.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const s=o=>{var a;i||(i=!0,navigation.removeEventListener("navigate",s),!o.userInitiated&&o.navigationType==="replace"&&((a=o.destination)===null||a===void 0?void 0:a.url)===n&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",s)}}}_oauthLoginInit(){return U(this,void 0,void 0,function*(){var e,n,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const s=new URLSearchParams(window.location.search);if(!s.get(Jt))return null;const o=s.get("error");if(o)return this._replaceUrlAfterOAuth(),{error:{message:o}};const a=s.get("code");if(!a)return null;this._replaceUrlAfterOAuth();try{const u=yield this._getCurrentUser(),d=(u==null?void 0:u.type)==="guest",{user:c}=yield cr({apiURI:this.config.apiURI,appId:this.config.appId,code:a,refreshToken:d?u.refresh_token:void 0});return this.setCurrentUser(c),null}catch(u){return((e=u==null?void 0:u.body)===null||e===void 0?void 0:e.type)==="record-not-found"&&((r=(n=u==null?void 0:u.body)===null||n===void 0?void 0:n.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=u==null?void 0:u.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return U(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(e){return this.mutationErrorCbs.push(e),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(n=>n!==e)}}subscribeAuth(e){this.authCbs.push(e);const n=this._currentUserCached;n.isLoading||e(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||Xe(i,n)||e(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==e)}}getAuth(){return U(this,void 0,void 0,function*(){const{user:e,error:n}=yield this.getCurrentUser();if(n)throw new Ae("Could not get current user: "+n.message);return e})}subscribeConnectionStatus(e){return this.connectionStatusCbs.push(e),()=>{this.connectionStatusCbs=this.connectionStatusCbs.filter(n=>n!==e)}}subscribeAttrs(e){return this.attrsCbs.push(e),this.attrs&&e(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(n=>n!==e)}}notifyAuthSubs(e){this.authCbs.forEach(n=>n(e))}notifyMutationErrorSubs(e){this.mutationErrorCbs.forEach(n=>n(e))}notifyAttrsSubs(){if(!this.attrs)return;const e=this.optimisticAttrs();this.attrsCbs.forEach(n=>n(e))}notifyConnectionStatusSubs(e){this.connectionStatusCbs.forEach(n=>n(e))}setCurrentUser(e){return U(this,void 0,void 0,function*(){this.kv.updateInPlace(n=>{n[Ve]=e}),yield this.kv.waitForKeyToLoad(Ve)})}getCurrentUserCached(){return this._currentUserCached}_getCurrentUser(){return U(this,void 0,void 0,function*(){const e=yield this.kv.waitForKeyToLoad(Ve);return typeof e=="string"?JSON.parse(e):e})}getCurrentUser(){return U(this,void 0,void 0,function*(){const e=yield this._waitForOAuthCallbackResponse();if(e!=null&&e.error){const n={error:e.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},n),n}try{const r={user:yield this._getCurrentUser(),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r}catch(n){return{user:void 0,isLoading:!1,error:{message:(n==null?void 0:n.message)||"Error loading user"}}}})}_hasCurrentUser(){return U(this,void 0,void 0,function*(){const e=yield this.kv.waitForKeyToLoad(Ve);return typeof e=="string"?JSON.parse(e)!=null:e!=null})}changeCurrentUser(e){return U(this,void 0,void 0,function*(){var n;const{user:r}=yield this.getCurrentUser();if(!Xe(r,e)){yield this.setCurrentUser(e),this.updateUser(e);try{(n=this._broadcastChannel)===null||n===void 0||n.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(e){const n={error:void 0,user:e};this._currentUserCached=Object.assign({isLoading:!1},n),this._dataForQueryCache={},this.querySubs.updateInPlace(r=>{Object.keys(r).forEach(i=>{delete r[i].result})}),this._reconnectTimeoutMs=0,this._transport.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(n)}sendMagicCode({email:e}){return xo({apiURI:this.config.apiURI,appId:this.config.appId,email:e})}signInWithMagicCode(e){return U(this,arguments,void 0,function*({email:n,code:r}){var i;const s=yield this.getCurrentUser(),o=((i=s==null?void 0:s.user)===null||i===void 0?void 0:i.type)==="guest",a=yield Do({apiURI:this.config.apiURI,appId:this.config.appId,email:n,code:r,refreshToken:o?s.user.refresh_token:void 0});return yield this.changeCurrentUser(a.user),a})}signInWithCustomToken(e){return U(this,void 0,void 0,function*(){const n=yield $o({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:e});return yield this.changeCurrentUser(n.user),n})}signInAsGuest(){return U(this,void 0,void 0,function*(){const e=yield Uo({apiURI:this.config.apiURI,appId:this.config.appId});return yield this.changeCurrentUser(e.user),e})}potentiallyInvalidateToken(e,n){var r;const i=(r=e==null?void 0:e.user)===null||r===void 0?void 0:r.refresh_token;if(!i)return;if(n.invalidateToken===!1){this._log.info("[auth-invalidate] skipped invalidateToken");return}Fo({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:i}).then(()=>{this._log.info("[auth-invalidate] completed invalidateToken")}).catch(o=>{})}signOut(e){return U(this,void 0,void 0,function*(){const n=yield this.getCurrentUser();this.potentiallyInvalidateToken(n,e),yield this.changeCurrentUser(null)})}createAuthorizationURL({clientName:e,redirectURL:n}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${e}&redirect_uri=${n}`}exchangeCodeForToken(e){return U(this,arguments,void 0,function*({code:n,codeVerifier:r}){var i;const s=yield this.getCurrentUser(),o=((i=s==null?void 0:s.user)===null||i===void 0?void 0:i.type)==="guest",a=yield cr({apiURI:this.config.apiURI,appId:this.config.appId,code:n,codeVerifier:r,refreshToken:o?s.user.refresh_token:void 0});return yield this.changeCurrentUser(a.user),a})}issuerURI(){const{apiURI:e,appId:n}=this.config;return`${e}/runtime/${n}`}signInWithIdToken(e){return U(this,arguments,void 0,function*({idToken:n,clientName:r,nonce:i}){var s;const o=yield this.getCurrentUser(),a=(s=o==null?void 0:o.user)===null||s===void 0?void 0:s.refresh_token,u=yield Lo({apiURI:this.config.apiURI,appId:this.config.appId,idToken:n,clientName:r,nonce:i,refreshToken:a});return yield this.changeCurrentUser(u.user),u})}joinRoom(e,n){let r=!1;this._rooms[e]||(r=!0,this._rooms[e]={isConnected:!1,error:void 0}),this._presence[e]=this._presence[e]||{};const i=this._presence[e].result;return n&&!i&&(this._presence[e].result=this._presence[e].result||{},this._presence[e].result.user=n,this._notifyPresenceSubs(e)),r&&this._tryJoinRoom(e,n),()=>{this._cleanupRoom(e)}}_cleanupRoom(e){var n,r,i,s;if(!(!((r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[e])!==null&&i!==void 0?i:{}).length){const o=(s=this._rooms[e])===null||s===void 0?void 0:s.isConnected;delete this._rooms[e],delete this._presence[e],delete this._broadcastSubs[e],o?this._tryLeaveRoom(e):this._roomsPendingLeave[e]=!0}}getPresence(e,n,r={}){const i=this._rooms[n],s=this._presence[n];return!i||!s||!s.result?null:Object.assign(Object.assign({},qo(s.result,r,this._sessionId)),{isLoading:!i.isConnected,error:i.error})}publishPresence(e,n,r){const i=this._rooms[n],s=this._presence[n];if(!i||!s)return;s.result=s.result||{};const o=Object.assign(Object.assign({},s.result.user),r);s.result.user=o,i.isConnected&&(this._trySetPresence(n,o),this._notifyPresenceSubs(n))}_trySetPresence(e,n){this._trySendAuthed(F(),{op:"set-presence","room-id":e,data:n})}_tryJoinRoom(e,n){this._trySendAuthed(F(),{op:"join-room","room-id":e,data:n}),delete this._roomsPendingLeave[e]}_tryLeaveRoom(e){this._trySendAuthed(F(),{op:"leave-room","room-id":e})}_trySetRoomConnected(e,n){const r=this._rooms[e];r&&(r.isConnected=n)}subscribePresence(e,n,r,i){const s=this.joinRoom(n,r.initialPresence||r.initialData),o=Object.assign(Object.assign({},r),{roomId:n,cb:i,prev:null});return this._presence[n]=this._presence[n]||{},this._presence[n].handlers=this._presence[n].handlers||[],this._presence[n].handlers.push(o),this._notifyPresenceSub(n,o),()=>{var a,u,d;this._presence[n].handlers=(d=(u=(a=this._presence[n])===null||a===void 0?void 0:a.handlers)===null||u===void 0?void 0:u.filter(c=>c!==o))!==null&&d!==void 0?d:[],s()}}_notifyPresenceSubs(e){var n,r;(r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(e,i)})}_notifyPresenceSub(e,n){const r=this.getPresence("",e,n);r&&(n.prev&&!Bo(r,n.prev)||(n.prev=r,n.cb(r)))}_patchPresencePeers(e,n){var r,i,s;const o=((i=(r=this._presence[e])===null||r===void 0?void 0:r.result)===null||i===void 0?void 0:i.peers)||{};let a=Object.fromEntries(Object.entries(o).map(([d,c])=>[d,{data:c}]));(s=this._presence[e])===null||s===void 0||s.result;const u=Ze(a,d=>{for(let[c,f,l]of n)switch(f){case"+":Si(d,c,l);break;case"r":kn(d,c,l);break;case"-":jn(d,c);break}delete d[this._sessionId]});this._setPresencePeers(e,u)}_setPresencePeers(e,n){const r=Object.assign({},n);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([s,o])=>[s,o.data]));this._presence=Ze(this._presence,s=>{kn(s,[e,"result","peers"],i)})}publishTopic({roomType:e,roomId:n,topic:r,data:i}){var s;const o=this._rooms[n];if(o){if(!o.isConnected){this._broadcastQueue[n]=(s=this._broadcastQueue[n])!==null&&s!==void 0?s:[],this._broadcastQueue[n].push({topic:r,roomType:e,data:i});return}this._tryBroadcast(n,e,r,i)}}_tryBroadcast(e,n,r,i){this._trySendAuthed(F(),{op:"client-broadcast","room-id":e,roomType:n,topic:r,data:i})}subscribeTopic(e,n,r){const i=this.joinRoom(e);return this._broadcastSubs[e]=this._broadcastSubs[e]||{},this._broadcastSubs[e][n]=this._broadcastSubs[e][n]||[],this._broadcastSubs[e][n].push(r),this._presence[e]=this._presence[e]||{},()=>{this._broadcastSubs[e][n]=this._broadcastSubs[e][n].filter(s=>s!==r),this._broadcastSubs[e][n].length||delete this._broadcastSubs[e][n],i()}}_notifyBroadcastSubs(e,n,r){var i,s,o;(o=(s=(i=this._broadcastSubs)===null||i===void 0?void 0:i[e])===null||s===void 0?void 0:s[n])===null||o===void 0||o.forEach(a=>{var u,d,c,f,l,p;const y=(u=r.data)===null||u===void 0?void 0:u.data,b=r.data["peer-id"]===this._sessionId?(c=(d=this._presence[e])===null||d===void 0?void 0:d.result)===null||c===void 0?void 0:c.user:(p=(l=(f=this._presence[e])===null||f===void 0?void 0:f.result)===null||l===void 0?void 0:l.peers)===null||p===void 0?void 0:p[r.data["peer-id"]];return a(y,b)})}uploadFile(e,n,r){return U(this,void 0,void 0,function*(){var i;const s=yield this.getCurrentUser(),o=(i=s==null?void 0:s.user)===null||i===void 0?void 0:i.refresh_token;return No(Object.assign(Object.assign({},r),{apiURI:this.config.apiURI,appId:this.config.appId,path:e,file:n,refreshToken:o}))})}deleteFile(e){return U(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield Ko({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}upload(e,n){return U(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),s=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,o=e||n.name,a=yield zo({apiURI:this.config.apiURI,appId:this.config.appId,fileName:o,refreshToken:s});return yield Vo(a,n)})}getDownloadUrl(e){return U(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield Wo({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}}let ct;function Oa(t,e){ct==null||ct.dispose();const n=Pa(e),r=ka(e,a),i=Aa(Ea(t));function s(c){var f;c.source===i.element.contentWindow&&((f=c.data)===null||f===void 0?void 0:f.type)==="close"&&n.isVisible()&&a()}function o(c){const f=c.shiftKey&&c.ctrlKey&&c.key==="0",l=c.key==="Escape"||c.key==="Esc";(f||l&&n.isVisible())&&a()}function a(){n.isVisible()?n.element.style.display="none":(n.element.style.display="block",n.element.contains(i.element)||n.element.appendChild(i.element))}function u(){n.element.remove(),r.element.remove(),removeEventListener("keydown",o),removeEventListener("message",s)}function d(){document.body.appendChild(n.element),document.body.appendChild(r.element),addEventListener("keydown",o),addEventListener("message",s),ct={dispose:u}}return d()}function Ea(t){return`${Qt||fr?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${t}`}function Aa(t){const e=document.createElement("iframe");return e.src=t,e.className="instant-devtool-iframe",Object.assign(e.style,{width:"100%",height:"100%",backgroundColor:"white",border:"none"}),{element:e}}function ka(t,e){const n=`
    <svg width="32" height="32" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,r=document.createElement("button");return r.innerHTML=n,r.className="instant-devtool-toggler",Object.assign(r.style,Object.assign(Object.assign({position:"fixed"},ja(t.position)),{height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"9010",padding:"0",margin:"0",border:"none",cursor:"pointer"})),r.addEventListener("click",e),{element:r}}function ja(t){switch(t){case"bottom-left":return{bottom:"24px",left:"24px"};case"bottom-right":return{bottom:"24px",right:"24px"};case"top-right":return{top:"24px",right:"24px"};case"top-left":return{top:"24px",left:"24px"}}}function Ca(t){switch(t){case"bottom-left":return{bottom:"24px",right:"24px",left:"60px",top:"72px"};case"bottom-right":return{bottom:"24px",left:"24px",right:"60px",top:"72px"};case"top-right":return{top:"24px",left:"24px",right:"60px",bottom:"72px"};case"top-left":return{top:"24px",right:"24px",left:"60px",bottom:"72px"}}}function Pa(t){const e=document.createElement("div");Object.assign(e.style,Object.assign(Object.assign({position:"fixed"},Ca(t.position)),{display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"})),e.style.display="none",e.className="instant-devtool-container";function n(){return e.style.display!=="none"}return{element:e,isVisible:n}}const Ia={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function Ma(){var t;return globalThis.__instantDbSchemaHashStore=(t=globalThis.__instantDbSchemaHashStore)!==null&&t!==void 0?t:new WeakMap,globalThis.__instantDbSchemaHashStore}function Ra(){var t;return globalThis.__instantDbStore=(t=globalThis.__instantDbStore)!==null&&t!==void 0?t:{},globalThis.__instantDbStore}function Zt(t){const e=t.__adminToken;return t.appId+"_"+(t.websocketURI||"default_ws_uri")+"_"+(t.apiURI||"default_api_uri")+"_"+(e||"client_only")+"_"+t.useDateObjects}const Xt=Ra(),$r=Ma();class xa{constructor(e){this.db=e,this.sendMagicCode=n=>this.db.sendMagicCode(n),this.signInWithMagicCode=n=>this.db.signInWithMagicCode(n),this.signInWithToken=n=>this.db.signInWithCustomToken(n),this.signInAsGuest=()=>this.db.signInAsGuest(),this.createAuthorizationURL=n=>this.db.createAuthorizationURL(n),this.signInWithIdToken=n=>this.db.signInWithIdToken(n),this.exchangeOAuthCode=n=>this.db.exchangeCodeForToken(n),this.issuerURI=()=>this.db.issuerURI(),this.signOut=(n={invalidateToken:!0})=>this.db.signOut(n)}}class Da{constructor(e){this.db=e,this.uploadFile=(n,r,i={})=>this.db.uploadFile(n,r,i),this.delete=n=>this.db.deleteFile(n),this.upload=(n,r)=>this.db.upload(n,r),this.put=this.upload,this.getDownloadUrl=n=>this.db.getDownloadUrl(n)}}function $a(t){return JSON.parse(JSON.stringify(t))}class Ua{constructor(e){this.tx=zt(),this._reactor=e,this.auth=new xa(this._reactor),this.storage=new Da(this._reactor)}transact(e){return this._reactor.pushTx(e)}getLocalId(e){return this._reactor.getLocalId(e)}subscribeQuery(e,n,r){return this._reactor.subscribeQuery(e,n,r)}subscribeAuth(e){return this._reactor.subscribeAuth(e)}getAuth(){return this._reactor.getAuth()}subscribeConnectionStatus(e){return this._reactor.subscribeConnectionStatus(e)}joinRoom(e="_defaultRoomType",n="_defaultRoomId",r){return{leaveRoom:this._reactor.joinRoom(n,r==null?void 0:r.initialPresence),subscribeTopic:(s,o)=>this._reactor.subscribeTopic(n,s,o),subscribePresence:(s,o)=>this._reactor.subscribePresence(e,n,s,o),publishTopic:(s,o)=>this._reactor.publishTopic({roomType:e,roomId:n,topic:s,data:o}),publishPresence:s=>this._reactor.publishPresence(e,n,s),getPresence:s=>this._reactor.getPresence(e,n,s)}}shutdown(){delete Xt[Zt(this._reactor.config)],this._reactor.shutdown()}queryOnce(e,n){return this._reactor.queryOnce(e,n)}_syncTableExperimental(e,n){return this._reactor.subscribeTable(e,n)}}function Ur(t){if(!t)return"0";const e=$r.get(t);if(e)return e;const n=N(t);return $r.set(t,n),n}function La(t,e){return Ur(t._reactor.config.schema)!==Ur(e)}function Fa(t,e,n,r,i){var s;const o=Object.assign(Object.assign({},t),{useDateObjects:(s=t.useDateObjects)!==null&&s!==void 0?s:!1}),a=Xt[Zt(o)];if(a)return La(a,o.schema)&&a._reactor.updateSchema(o.schema),a;const u=new Sa(Object.assign(Object.assign(Object.assign({},Ia),o),{cardinalityInference:!!o.schema}),e||ar,n||ur,Object.assign(Object.assign({},r||{}),{"@instantdb/core":_r}),i),d=new Ua(u);return Xt[Zt(o)]=d,Na(o.appId,o.devtool),d}function Na(t,e){if(typeof window>"u"||typeof window.location>"u"||typeof document>"u"||typeof e=="boolean"&&!e)return;const n=Object.assign({position:"bottom-right",allowedHosts:["localhost"]},typeof e=="object"?e:{});n.allowedHosts.includes(window.location.hostname)&&Oa(t,n)}const Ka={isLoading:!0,data:void 0,pageInfo:void 0,error:void 0};function Lr(t){return{isLoading:!t,data:void 0,pageInfo:void 0,error:void 0,...t||{}}}function za(t,e,n){e&&n&&"ruleParams"in n&&(e={$$ruleParams:n.ruleParams,...e});const r=e?$a(e):null,i=N(r),s=k.useRef(Lr(t._reactor.getPreviousResult(r))),o=k.useCallback(u=>(s.current=Lr(t._reactor.getPreviousResult(r)),r?t.subscribeQuery(r,c=>{s.current={isLoading:!c,data:void 0,pageInfo:void 0,error:void 0,...c},u()}):()=>{}),[i]);return{state:k.useSyncExternalStore(o,()=>s.current,()=>Ka),query:r}}function Va(){const t=k.useRef(null);k.useEffect(()=>{n()},[]);function e(r,i){n(),t.current=setTimeout(i,r)}function n(){t.current&&clearTimeout(t.current)}return{set:e,clear:n}}const Wa=1e3;function qa(t,e,n){const r=k.useRef(n);r.current=n,k.useEffect(()=>t.core._reactor.subscribeTopic(t.id,e,(s,o)=>{r.current(s,o)}),[t.id,e])}function Ba(t,e){return k.useEffect(()=>t.core._reactor.joinRoom(t.id),[t.id]),k.useCallback(r=>{t.core._reactor.publishTopic({roomType:t.type,roomId:t.id,topic:e,data:r})},[t.id,e])}function Ga(t,e={}){var o,a;const[n,r]=k.useState(()=>t.core._reactor.getPresence(t.type,t.id,e)??{peers:{},isLoading:!0});k.useEffect(()=>t.core._reactor.subscribePresence(t.type,t.id,e,d=>{r(d)}),[t.id,e.user,(o=e.peers)==null?void 0:o.join(),(a=e.keys)==null?void 0:a.join()]);const i=k.useCallback(u=>{t.core._reactor.publishPresence(t.type,t.id,u)},[t.type,t.id]);return k.useMemo(()=>({...n,publishPresence:i}),[n,i])}function Qa(t,e,n){k.useEffect(()=>t.core._reactor.joinRoom(t.id,e),[t.id]),k.useEffect(()=>t.core._reactor.publishPresence(t.type,t.id,e),[t.type,t.id,n??JSON.stringify(e)])}function Ha(t,e,n={}){const r=Va(),i=ge.usePresence(t,{keys:[e]}),s=k.useMemo(()=>{const c=t._core._reactor.getPresence(t.type,t.id);return n!=null&&n.writeOnly?[]:Object.values((c==null?void 0:c.peers)??{}).filter(f=>f[e]===!0)},[n==null?void 0:n.writeOnly,i]),o=k.useCallback(c=>{t.core._reactor.publishPresence(t.type,t.id,{[e]:c}),c&&((n==null?void 0:n.timeout)===null||(n==null?void 0:n.timeout)===0||r.set((n==null?void 0:n.timeout)??Wa,()=>{t.core._reactor.publishPresence(t.type,t.id,{[e]:null})}))},[t.type,t.id,e,n==null?void 0:n.timeout,r]),a=k.useCallback(c=>{const l=!((n==null?void 0:n.stopOnEnter)&&c.key==="Enter");o(l)},[n.stopOnEnter,o]),u=k.useCallback(()=>{o(!1)},[o]),d=k.useMemo(()=>({onKeyDown:a,onBlur:u}),[a,u]);return{active:s,setActive:o,inputProps:d}}const ge={useTopicEffect:qa,usePublishTopic:Ba,usePresence:Ga,useSyncPresence:Qa,useTypingIndicator:Ha};class Ya{constructor(e,n,r){this.useTopicEffect=(i,s)=>{ge.useTopicEffect(this,i,s)},this.usePublishTopic=i=>ge.usePublishTopic(this,i),this.usePresence=(i={})=>ge.usePresence(this,i),this.useSyncPresence=(i,s)=>ge.useSyncPresence(this,i,s),this.useTypingIndicator=(i,s={})=>ge.useTypingIndicator(this,i,s),this.core=e,this._core=this.core,this.type=n,this.id=r}}const Ja={isLoading:!0,user:void 0,error:void 0};class Za{constructor(e,n){this.tx=zt(),this.getLocalId=r=>this.core.getLocalId(r),this.useLocalId=r=>{const[i,s]=k.useState(null);return k.useEffect(()=>{(async()=>{const a=await this.getLocalId(r);s(a)})()},[r]),i},this.rooms=ge,this.transact=r=>this.core.transact(r),this.useQuery=(r,i)=>za(this.core,r,i).state,this.useAuth=()=>{const r=k.useRef(this.core._reactor._currentUserCached),i=k.useCallback(o=>this.core.subscribeAuth(u=>{r.current={isLoading:!1,...u},o()}),[]);return k.useSyncExternalStore(i,()=>r.current,()=>Ja)},this.useUser=()=>{const{user:r}=this.useAuth();if(!r)throw new Ae("useUser must be used within an auth-protected route");return r},this.useConnectionStatus=()=>{const r=k.useRef(this.core._reactor.status),i=k.useCallback(o=>this.core.subscribeConnectionStatus(u=>{u!==r.current&&(r.current=u,o())}),[]);return k.useSyncExternalStore(i,()=>r.current,()=>"connecting")},this.queryOnce=(r,i)=>this.core.queryOnce(r,i),this.SignedIn=({children:r})=>{const i=this.useAuth();return i.isLoading||i.error||!i.user?null:Ge.jsx(Ge.Fragment,{children:r})},this.SignedOut=({children:r})=>{const i=this.useAuth();return i.isLoading||i.error||i.user?null:Ge.jsx(Ge.Fragment,{children:r})},this.core=Fa(e,this.constructor.Storage,this.constructor.NetworkListener,n,this.constructor.EventSourceImpl),this._core=this.core,this.auth=this.core.auth,this.storage=this.core.storage}room(e="_defaultRoomType",n="_defaultRoomId"){return new Ya(this.core,e,n)}getAuth(){return this.core.getAuth()}}le.InstantReactAbstractDatabase=Za,Object.defineProperty(le,Symbol.toStringTag,{value:"Module"})});
